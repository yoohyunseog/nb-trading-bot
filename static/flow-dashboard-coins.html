<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>8BIT Flow Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/flow-dashboard.css?v=v0.0.3" rel="stylesheet">
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <!-- Chart.js for summary and mini charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- External N/B calculation library (same as index.html) -->
  <script src="https://xn--9l4b4xi9r.com/_8%EB%B9%84%ED%8A%B8/js/bitCalculation.v.0.2.js"></script>
</head>
<body>
  <div class="container-main">
    <!-- Header -->
    <div class="header">
      <div class="header-title">🔄 Flow Dashboard</div>
      
      <!-- Performance Monitor (FPS Style) -->
      <div class="perf-monitor">
        <div class="perf-stat">
          <div class="perf-stat-label">FPS</div>
          <div class="perf-stat-value" id="perfFPS">60</div>
        </div>
        <div class="perf-divider"></div>
        <div class="perf-stat">
          <div class="perf-stat-label">Memory</div>
          <div class="perf-stat-value" id="perfMemory">0 MB</div>
        </div>
        <div class="perf-divider"></div>
        <div class="perf-stat">
          <div class="perf-stat-label">CPU</div>
          <div class="perf-stat-value" id="perfCPU">0%</div>
        </div>
        <div class="perf-divider"></div>
        <div class="perf-stat">
          <div class="perf-stat-label">Cache</div>
          <div class="perf-stat-value" id="perfCache">0</div>
        </div>
        <div class="perf-divider"></div>
        <div class="perf-stat">
          <div class="perf-stat-label">Storage</div>
          <div class="perf-stat-value" id="perfStorage">0 KB</div>
        </div>
        <div class="perf-divider"></div>
        <div class="perf-timing-chart">
          <div class="perf-stat-label">Step Timing (ms)</div>
          <canvas id="perfTimingChart" width="250" height="30"></canvas>
          <div id="perfAvgTime" class="perf-avg-time">Avg: 0ms</div>
        </div>
        <div class="perf-divider"></div>
        <button id="perfCleanBtn" class="perf-clean-btn" title="메모리 정리">🧹</button>
      </div>

      <!-- Auto Buy Status + BTC Price -->
      <div style="display:flex; align-items:center; gap:20px; margin-left:20px; padding-left:20px; border-left:1px solid rgba(255,255,255,0.1);">
        <!-- BTC 현재 가격 -->
        <div style="display:flex; flex-direction:column; gap:4px;">
          <div style="font-size:9px; color:#9aa8c2;">BTC 가격</div>
          <div id="btcPrice" style="font-size:14px; font-weight:700; color:#f7931a;">-</div>
        </div>

        <!-- Auto Buy 최근 로그 -->
        <div style="display:flex; flex-direction:column; gap:4px; max-width:400px;">
          <div style="font-size:9px; color:#9aa8c2;">⚙️ Auto Buy</div>
          <div id="autoBuyStatusBar" style="font-size:11px; color:#d9e2f3; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-family:monospace;">대기 중...</div>
        </div>
      </div>
      
      <div class="live-indicator">
        <div class="live-dot"></div>
        <span id="systemStatus">N/B START...</span>
        <div class="progress-steps" id="progressSteps">
          <span class="step-num" data-step="1">1</span>
          <span class="step-num" data-step="2">2</span>
          <span class="step-num" data-step="3">3</span>
          <span class="step-num" data-step="4">4</span>
          <span class="step-num" data-step="5">5</span>
          <span class="step-num" data-step="6">6</span>
          <span class="step-num" data-step="7">7</span>
          <span class="step-num" data-step="8">8</span>
          <span class="step-num" data-step="9">9</span>
          <span class="step-num" data-step="10">10</span>
        </div>
      </div>
    </div>

    <!-- Step 1: Market Analysis -->
    <div class="step1-container">
      <div class="step1-title">1단계 분봉 선택</div>

      <!-- Timeframe Selection -->
      <div class="timeframe-section">
        <div class="section-label">📊 분봉 선택</div>
        <div class="timeframe-buttons">
          <button class="timeframe-btn active" data-interval="minute1" onclick="selectTimeframe('minute1')">1분</button>
          <button class="timeframe-btn" data-interval="minute3" onclick="selectTimeframe('minute3')">3분</button>
          <button class="timeframe-btn" data-interval="minute5" onclick="selectTimeframe('minute5')">5분</button>
          <button class="timeframe-btn" data-interval="minute10" onclick="selectTimeframe('minute10')">10분</button>
          <button class="timeframe-btn" data-interval="minute15" onclick="selectTimeframe('minute15')">15분</button>
          <button class="timeframe-btn" data-interval="minute30" onclick="selectTimeframe('minute30')">30분</button>
          <button class="timeframe-btn" data-interval="minute60" onclick="selectTimeframe('minute60')">1시간</button>
          <button class="timeframe-btn" data-interval="day" onclick="selectTimeframe('day')">일봉</button>
        </div>
      </div>

      <!-- Trust Section -->
      <div class="trust-section">
        <!-- ML Model Trust -->
        <div class="trust-box">
          <div class="trust-label">
            <span class="trust-icon">🤖</span>
            ML Model Trust
          </div>
          <div class="trust-value" id="mlTrust">0%</div>
        </div>

        <!-- N/B Guild Trust -->
        <div class="trust-box">
          <div class="trust-label">
            <span class="trust-icon">🏛️</span>
            N/B Guild Trust
          </div>
          <div class="trust-value nb" id="nbTrust">0%</div>
        </div>
      </div>

      <!-- N/B Zone Status -->
      <div class="zone-section">
        <div class="section-label">🎯 N/B Zone Status</div>
        
        <div class="zone-info">
          <div class="zone-item">
            <div class="zone-item-label">Timeframe</div>
            <div class="zone-item-value" id="currentTimeframe">-</div>
          </div>
          <div class="zone-item">
            <div class="zone-item-label">Current Zone</div>
            <div class="zone-item-value">
              <span class="zone-badge" id="currentZone">-</span>
            </div>
          </div>
          <div class="zone-item">
            <div class="zone-item-label">Zone Count</div>
            <div class="zone-item-value" id="zoneCount">0</div>
          </div>
        </div>

        <!-- Zone Chart Visualization -->
        <div class="zone-chart-label">Visible chart zones (left=older → right=newer) 🔮</div>
        <div class="zone-chart" id="zoneChart">
          <!-- Chart segments will be rendered here -->
        </div>
      </div>

    </div>


    <!-- Step 2: Analysis & Card Generation -->
    <div class="step2-container" id="step2Section">
      <div class="step2-title">2단계: win%, 그래프 분석 및 카드 생성</div>
      
      <div class="row g-3">
        <!-- Left: Win Rate Card (index.html 스타일) -->
        <div class="col-lg-3">
          <div class="win-rate-box" style="background:linear-gradient(180deg, rgba(255,183,3,0.10), rgba(14,20,36,0.85)); box-shadow:0 10px 30px rgba(0,0,0,0.35);">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <strong class="text-white">Win%</strong>
                <div style="font-size:11px; color:#d9e2f3;">로컬 스냅샷 + 서버 히스토리</div>
              </div>
              <div class="d-flex align-items-center gap-2">
                <div class="btn-group btn-group-sm" role="group" aria-label="Zone filter" style="border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden;">
                  <button type="button" id="winZoneAll" class="btn btn-dark">ALL</button>
                  <button type="button" id="winZoneBlue" class="btn btn-primary">BLUE</button>
                  <button type="button" id="winZoneOrange" class="btn btn-warning">ORANGE</button>
                </div>
                <span id="winMajor" class="badge bg-white text-dark">-</span>
              </div>
            </div>
            
            <!-- Zone Status Section -->
            <div class="win-zone-section mb-3" style="background:rgba(0,0,0,0.25); border-radius:10px; padding:10px;">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="zone-display-label">25개 히스토리</span>
                <div class="d-flex align-items-center gap-2" style="font-size:11px; color:#d9e2f3;">
                  <span id="winLocalCount" class="badge bg-dark text-white">0</span>
                  <span id="winServerCount" class="badge bg-secondary text-white">0</span>
                </div>
              </div>
              <div id="zoneConsistencyInfo" class="zone-consistency-display">
                <div class="zone-consistency-content">
                  🔄 <span class="sync-status">실시간 동기화</span> | 
                  N/B: <span id="nbZoneDisplay">-</span> | 
                  ML: <span id="mlZoneDisplay">-</span>
                </div>
              </div>
            </div>
            
            <!-- Progress Bar -->
            <div id="winFillTrack" class="win-progress-track mb-3" style="height:10px; border-radius:12px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); overflow:hidden;">
              <div id="winFillBar" class="win-progress-bar" style="height:100%; width:1%; background:#ffffff; transition:width .4s ease"></div>
            </div>

            <!-- 카드 등급 표시 -->
            <div class="d-flex justify-content-between align-items-center mb-2" style="background:rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:8px 10px;">
              <div>
                <div style="font-size:10px; color:#9aa8c2;">카드 등급</div>
                <div id="winCardGrade" style="font-size:14px; font-weight:700; color:#ffd700;">-</div>
              </div>
              <div class="text-end">
                <div id="winCardLeague" style="font-size:11px; color:#d9e2f3;">-</div>
                <div id="winCardMlGrade" style="font-size:10px; color:#9aa8c2;">&nbsp;</div>
              </div>
            </div>

            <!-- 카드 등급 추이 그래프 -->
            <div style="background:rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.08); border-radius:10px; padding:8px 10px; margin-bottom:10px;">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <div class="zone-display-label">카드 등급 추이</div>
                <span id="winGradeTrendLabel" class="badge bg-dark text-white">-</span>
              </div>
              <div style="height:110px;">
                <canvas id="winGradeTrendChart"></canvas>
              </div>
            </div>

            <!-- Win History List -->
            <div id="winList" class="win-history-list flex-grow-1" style="gap:8px; overflow-y:auto; overflow-x:hidden;"></div>
          </div>
        </div>
        
        <!-- Center: Graph -->
        <div class="col-lg-6">
          <div class="graph-container" id="step2Graph">
            <!-- LightweightCharts will be rendered here -->
          </div>
          <!-- Auto Buy Strategy -->
          <div class="card border-info rounded-3 p-3 mt-3" style="background: linear-gradient(135deg, rgba(0,209,255,0.08), rgba(14,20,36,0.6));">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <h6 class="m-0" style="color:#00d1ff; font-weight:700;">⚙️ Auto Buy (BLUE 지역)</h6>
                <small class="text-muted">주기적으로 BLUE 지역에서 자동 매수</small>
              </div>
              <span id="autoBuyStatus" class="badge bg-secondary">OFF</span>
            </div>

            <div class="row g-2">
              <div class="col-6">
                <label class="form-label" style="font-size:11px; color:#9aa8c2;">주기 (초)</label>
                <select id="autoBuyInterval" class="form-select form-select-sm">
                  <option value="60">60초 (1분)</option>
                  <option value="180">180초 (3분)</option>
                  <option value="300">300초 (5분)</option>
                  <option value="600">600초 (10분)</option>
                  <option value="900">900초 (15분)</option>
                  <option value="1800">1800초 (30분)</option>
                  <option value="3600">3600초 (1시간)</option>
                  <option value="86400">86400초 (일봉)</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label" style="font-size:11px; color:#9aa8c2;">매수 금액 (KRW)</label>
                <input id="autoBuyAmount" type="number" value="5000" min="1000" step="1000" class="form-control form-control-sm" />
              </div>
            </div>

            <div class="row g-2 mt-2">
              <div class="col-6">
                <label class="form-label" style="font-size:11px; color:#9aa8c2;">수수료 (%)</label>
                <input id="tradingFeeRate" type="number" value="0.05" min="0" max="1" step="0.01" class="form-control form-control-sm" />
                <small class="text-muted" style="font-size:9px;">매수+매도 각각 적용</small>
              </div>
              <div class="col-6">
                <label class="form-label" style="font-size:11px; color:#9aa8c2;">총 수수료</label>
                <div id="totalFeeDisplay" style="font-size:14px; font-weight:700; color:#00d1ff; margin-top:8px;">0.1%</div>
              </div>
            </div>

            <!-- Auto Buy 옵션 -->
            <div class="row g-2 mt-2">
              <div class="col-12">
                <div style="background:rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:10px;">
                  <div style="font-size:10px; font-weight:600; color:#00d1ff; margin-bottom:8px;">📋 매수 옵션</div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="autoBuyBlueOnly" checked />
                    <label class="form-check-label" for="autoBuyBlueOnly" style="font-size:11px; color:#d9e2f3;">💠 BLUE 카드만 매수 (카드 zone 기준)</label>
                  </div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="autoBuyNoDuplicate" checked />
                    <label class="form-check-label" for="autoBuyNoDuplicate" style="font-size:11px; color:#d9e2f3;">같은 코인 중복 매수 방지</label>
                  </div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="autoBuyHigherGrade" />
                    <label class="form-check-label" for="autoBuyHigherGrade" style="font-size:11px; color:#d9e2f3;">높은 등급만 매수</label>
                    <small class="text-muted" style="font-size:9px; display:block; margin-left:24px;">현재 보유 카드보다 높은 등급만</small>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="autoBuyBlueCardOnly" checked />
                    <label class="form-check-label" for="autoBuyBlueCardOnly" style="font-size:11px; color:#d9e2f3;">💙 Blue Card만 매수</label>
                    <small class="text-muted" style="font-size:9px; display:block; margin-left:24px;">Blue(+강화)만 매수, Orange(-강화) 제외</small>
                  </div>

                  <div style="margin-top:12px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.1);">
                    <label class="form-label" style="font-size:10px; color:#9aa8c2; margin-bottom:6px;">대기 시간 후 주기적 매수 (초)</label>
                    <select id="autoBuyWaitTime" class="form-select form-select-sm">
                      <option value="0">즉시 (0초)</option>
                      <option value="5">5초</option>
                      <option value="10">10초</option>
                      <option value="15">15초</option>
                      <option value="30">30초</option>
                      <option value="60">60초 (1분)</option>
                      <option value="120">120초 (2분)</option>
                      <option value="300">300초 (5분)</option>
                      <option value="600">600초 (10분)</option>
                      <option value="1800">1800초 (30분)</option>
                      <option value="3600">3600초 (1시간)</option>
                      <option value="7200">7200초 (2시간)</option>
                      <option value="14400">14400초 (4시간)</option>
                    </select>
                    <small class="text-muted" style="font-size:9px; display:block; margin-top:4px;">대기 후 이 주기로 매수 시도 (성공시 다시 대기)</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex align-items-center justify-content-between mt-2">
              <button id="autoBuyToggle" class="btn btn-sm btn-outline-info w-100">▶️ 시작</button>
            </div>

            <!-- 프로그레스바 -->
            <div class="mt-2">
              <!-- 대기 시간 프로그레스바 -->
              <div id="abWaitPhase" style="display:none;">
                <div class="d-flex justify-content-between align-items-center" style="font-size:11px; margin-bottom:4px;">
                  <span id="abWaitStatusText" style="color:#ffb703; font-weight:600;">⏳ 대기 중...</span>
                  <span id="abWaitTimeText" style="color:#9aa8c2;">-</span>
                </div>
                <div style="height:14px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden; position:relative;">
                  <div id="abWaitProgressBar" style="height:100%; width:0%; background:linear-gradient(90deg,#ffb703,#ffa500); transition:width .25s linear"></div>
                  <div id="abWaitProgressText" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:10px; color:#fff; font-weight:600; text-shadow:0 0 4px #000;">-</div>
                </div>
              </div>
              
              <!-- 매수 단계 프로그레스바 -->
              <div id="abBuyingPhase" style="display:none;">
                <div class="d-flex justify-content-between align-items-center" style="font-size:11px; margin-bottom:4px;">
                  <span id="abBuyingStatusText" style="color:#0ecb81; font-weight:600;">🔄 매수 시도 중...</span>
                  <span id="abNextBuyText" style="color:#9aa8c2;">-</span>
                </div>
                <div style="height:14px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden; position:relative;">
                  <div id="abProgressBar" style="height:100%; width:0%; background:linear-gradient(90deg,#0ecb81,#00d1ff); transition:width .25s linear"></div>
                  <div id="abProgressText" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:10px; color:#fff; font-weight:600; text-shadow:0 0 4px #000;">-</div>
                </div>
              </div>
            </div>

            <!-- Auto Buy 로그 -->
            <div style="background:rgba(0,0,0,0.3); border:1px solid rgba(0,209,255,0.3); border-radius:8px; padding:10px; margin-top:12px; max-height:150px; overflow-y:auto;">
              <div style="font-size:9px; font-weight:600; color:#00d1ff; margin-bottom:6px;">📊 매수 로그</div>
              <div id="autoBuyLogContainer" style="font-size:9px; color:#d9e2f3; font-family:monospace; line-height:1.4;">
                <div style="color:#9aa8c2;">로그 대기중...</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right: Production N/B Card (생산 N/B Card) -->
        <div class="col-lg-3">
          <div class="card-generation-box" style="background: linear-gradient(135deg, rgba(30,35,41,0.9), rgba(14,20,36,0.9)); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 14px; display: flex; flex-direction: column; gap: 10px;">
            <!-- 헤더 -->
            <div class="d-flex justify-content-between align-items-center mb-1" style="border-bottom: 2px solid rgba(0,209,255,0.3); padding-bottom: 8px;">
              <div>
                <strong class="text-white" style="font-size: 16px;">🎯 생산 N/B Card</strong>
                <div style="font-size: 10px; margin-top: 6px;">
                  <div class="text-muted" id="ccTimestamp">-</div>
                  <div style="color: #00d1ff; font-weight: 600; margin-top: 3px;">분봉: <span id="ccTimeframeDisplay">10m</span></div>
                </div>
              </div>
              <span id="ccInterval" class="badge bg-info" style="font-size: 10px; padding: 4px 8px;">-</span>
            </div>

            <!-- 카드 등급 -->
            <div id="ccRatingSection" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; border: 1px solid rgba(255,255,255,0.2);">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="text-muted" style="font-size: 10px; margin-bottom: 4px;">카드 등급</div>
                  <div id="ccRatingDisplay" style="font-size: 16px; font-weight: 700;">-</div>
                </div>
                <div class="text-end">
                  <div class="text-muted" style="font-size: 10px; margin-bottom: 4px;">점수</div>
                  <div id="ccRatingScore" style="font-size: 14px; font-weight: 600; color: #00d1ff;">-</div>
                </div>
              </div>
            </div>

            <!-- 현재 가격 -->
            <div style="background: rgba(0,209,255,0.1); border-radius: 8px; padding: 10px; border: 1px solid rgba(0,209,255,0.3);">
              <div class="zone-display-label" style="margin-bottom: 4px;">현재 가격</div>
              <div id="ccPrice" style="font-size: 18px; font-weight: 700; color: #00d1ff; word-break: break-all;">-</div>
              <div id="ccCurrentPrice" style="display:none;">-</div>
            </div>

            <!-- 거래량 & 거래대금 -->
            <div class="row g-2">
              <div class="col-6">
                <div style="background: rgba(14,203,129,0.1); border-radius: 6px; padding: 8px; border: 1px solid rgba(14,203,129,0.3);">
                  <div class="zone-display-label" style="font-size: 9px; margin-bottom: 2px;">거래량</div>
                  <div id="ccVolume" style="font-size: 12px; font-weight: 700; color: #0ecb81; word-break: break-all;">-</div>
                </div>
              </div>
              <div class="col-6">
                <div style="background: rgba(66,133,244,0.1); border-radius: 6px; padding: 8px; border: 1px solid rgba(66,133,244,0.3);">
                  <div class="zone-display-label" style="font-size: 9px; margin-bottom: 2px;">거래대금</div>
                  <div id="ccTurnover" style="font-size: 12px; font-weight: 700; color: #4285f4; word-break: break-all;">-</div>
                </div>
              </div>
            </div>

            <!-- 가격/거래량/거래대금 N/B -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
              <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">💰 가격</div>
                <div class="d-flex justify-content-between mb-1"><span class="text-muted" style="font-size: 10px;">MAX</span><span id="ccPriceMax" style="font-size: 11px; font-weight: 600; color: #0ecb81;">-</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted" style="font-size: 10px;">MIN</span><span id="ccPriceMin" style="font-size: 11px; font-weight: 600; color: #f6465d;">-</span></div>
              </div>
              <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">📈 거래량</div>
                <div class="d-flex justify-content-between mb-1"><span class="text-muted" style="font-size: 10px;">MAX</span><span id="ccVolMax" style="font-size: 11px; font-weight: 600; color: #2bdab5;">-</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted" style="font-size: 10px;">MIN</span><span id="ccVolMin" style="font-size: 11px; font-weight: 600; color: #ffb703;">-</span></div>
              </div>
              <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">💵 거래대금</div>
                <div class="d-flex justify-content-between mb-1"><span class="text-muted" style="font-size: 10px;">MAX</span><span id="ccTurnMax" style="font-size: 11px; font-weight: 600; color: #4285f4;">-</span></div>
                <div class="d-flex justify-content-between"><span class="text-muted" style="font-size: 10px;">MIN</span><span id="ccTurnMin" style="font-size: 11px; font-weight: 600; color: #9c27b0;">-</span></div>
              </div>
            </div>

            <!-- Mini Zone Chart -->
            <div style="background: rgba(14,20,36,0.8); border-radius: 8px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
              <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">📊 N/B WAVE</div>
              <div id="ccMiniZoneChart" style="display: flex; gap: 1px; height: 24px; border-radius: 4px; overflow: hidden;"></div>
            </div>

            <!-- 요약 그래프 -->
            <div style="position: relative; height: 110px; padding: 8px 0;">
              <div style="display:flex; justify-content:flex-start; align-items:center; margin-bottom: 8px; position: relative; z-index: 10;">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff;">📊 추이 그래프</div>
              </div>
              <div style="position: absolute; top: 40px; left: 0; width: 100%; height: 70px;">
                <canvas id="ccSummaryChart" style="width: 100% !important; height: 100% !important;"></canvas>
              </div>
            </div>

            <!-- N/B WAVE STATUS -->
            <div style="background: rgba(14,20,36,0.8); border-radius: 8px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around; align-items: center;">
              <div style="text-align: center; flex: 1;">
                <div style="font-size: 10px; font-weight: 700; color: #00d1ff; margin-bottom: 4px;">🔵 BLUE</div>
                <div id="ccWaveR" style="font-size: 13px; font-weight: 700; color: #00d1ff;">-</div>
              </div>
              <div style="width: 1px; height: 30px; background: rgba(255,255,255,0.1);"></div>
              <div style="text-align: center; flex: 1;">
                <div style="font-size: 10px; font-weight: 700; color: #ffb703; margin-bottom: 4px;">🟠 ORANGE</div>
                <div id="ccWaveW" style="font-size: 13px; font-weight: 700; color: #ffb703;">-</div>
              </div>
              <div style="width: 1px; height: 30px; background: rgba(255,255,255,0.1);"></div>
              <div style="text-align: center; flex: 1;">
                <div style="font-size: 9px; font-weight: 600; color: #9aa8c2; margin-bottom: 4px;">상태</div>
                <div id="ccWaveStatus" style="font-size: 11px; font-weight: 700; color: #2ecc71;">Normal</div>
              </div>
            </div>

            <!-- N/B Zone & ML Trust -->
            <div class="row g-2">
              <div class="col-6">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 4px;">🗺️ N/B Zone</div>
                <div id="ccNBZone" style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); font-size: 10px; color: #e6eefc; min-height: 30px;">-</div>
              </div>
              <div class="col-6">
                <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 4px;">🤖 ML Trust</div>
                <div id="ccMLTrust" style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); font-size: 10px; color: #e6eefc; min-height: 30px;">-</div>
              </div>
            </div>

            <!-- 판매 실현 손익 -->
            <div class="row g-2">
              <div class="col-6">
                <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 8px;">
                  <div class="text-muted" style="font-size: 10px;">판매 평균 실현 손익</div>
                  <div id="ccRealizedAvg" style="font-size: 13px; font-weight: 700;">0 KRW</div>
                </div>
              </div>
              <div class="col-6">
                <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 8px;">
                  <div class="text-muted" style="font-size: 10px;">판매 최고 실현 손익</div>
                  <div id="ccRealizedMax" style="font-size: 13px; font-weight: 700;">0 KRW</div>
                </div>
              </div>
            </div>

            <!-- 버튼 및 상태 -->
            <div class="mt-auto" style="display: flex; flex-direction: column; gap: 8px;">
              <div class="d-flex align-items-center gap-2">
                <label class="text-muted" style="font-size: 11px; white-space: nowrap;">매수 금액</label>
                <input id="ccBuyAmount" type="number" value="5000" min="1000" step="1000" class="form-control form-control-sm" style="flex: 1;" />
              </div>
              <div class="d-grid gap-2">
                <button id="ccBuy" class="btn btn-sm btn-success">🛒 생산 N/B 매수</button>
                <button id="ccPaperBuy" class="btn btn-sm btn-warning">🧪 가상 매수</button>
                <button id="ccRefresh" class="btn btn-sm btn-outline-info">🔄 새로고침</button>
              </div>
              <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
                <button id="ccSave" class="btn btn-sm btn-primary w-100 mb-2">💾 NBverse 저장</button>
                <div style="font-size: 11px; font-weight: 600; color: #2ecc71; text-align: center;">
                  <span id="ccSaveHint">대기</span>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center" style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 6px;">
                <div style="text-align: center; flex: 1;">
                  <div class="zone-display-label" style="font-size: 9px; margin-bottom: 2px;">BUY</div>
                  <span id="buyCardCount" class="badge bg-success" style="font-size: 11px;">0</span>
                </div>
                <div style="text-align: center; flex: 1;">
                  <div class="zone-display-label" style="font-size: 9px; margin-bottom: 2px;">SELL</div>
                  <span id="sellCardCount" class="badge bg-danger" style="font-size: 11px;">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 7: 자산 조회 -->
    <div class="step7-container" id="assetTotalBox">
      <div class="step7-title">3단계: 자산 조회</div>
      
      <!-- 자산 요약 -->
      <div class="card border-secondary rounded-3 p-3 mb-3" style="background: rgba(14,20,36,0.6);">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex align-items-center gap-2">
            <strong class="text-white">📊 자산</strong>
            <span id="assetsMeta" class="text-muted" style="font-size:11px">-</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button id="assetsRefresh" class="btn btn-sm btn-outline-info" onclick="loadAssets7()">🔄 새로고침</button>
          </div>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-12 col-md-4">
            <div class="asset-stat">
              <div class="label">총 자산 (KRW)</div>
              <div class="value" id="assetTotal">-</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="asset-stat">
              <div class="label">사용 가능 KRW</div>
              <div class="value" id="assetBuyable">-</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="asset-stat">
              <div class="label">BTC 보유 자산</div>
              <div class="value">
                <div id="assetBtcAmount">-</div>
                <div id="assetBtcValue" style="font-size: 11px; color: #9aa8c2;">-</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="asset-stat">
              <div class="label">BTC 평균가</div>
              <div class="value" id="assetBtcAvg">-</div>
            </div>
          </div>
        </div>

        <div class="asset-bars" id="assetsBars"></div>


    </div>

      
      <!-- Step 8, 9: 매수/매도 완료 카드 (좌우 배치) -->
      <div class="row g-3 mb-4">
        <!-- Step 8: 매수 완료 카드 -->
        <div class="col-12 col-lg-6">
          <div class="step8-container">
            <div class="card border-success rounded-3 p-3" style="background: linear-gradient(135deg, rgba(14,203,129,0.1), rgba(14,203,129,0.05)); min-height: 500px;">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h5 class="m-0" style="color: #0ecb81;">🛒 매수 완료 카드</h5>
                  <small class="text-muted" id="buyStatsTime">-</small>
                </div>
                <span id="buyCount" class="badge bg-success" style="font-size: 16px;">0</span>
              </div>

              <!-- 매수 요약 (카드 전용) -->
              <div class="row g-2 mb-3 text-center" style="font-size:12px; color:#d9e2f3;">
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">평균</div>
                    <div id="buyCardAvg" style="font-size: 14px; font-weight: 700; color: #00d1ff;">-</div>
                  </div>
                </div>
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">최고</div>
                    <div id="buyCardMax" style="font-size: 14px; font-weight: 700; color: #0ecb81;">-</div>
                  </div>
                </div>
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">최저</div>
                    <div id="buyCardMin" style="font-size: 14px; font-weight: 700; color: #9aa8c2;">-</div>
                  </div>
                </div>
              </div>
              
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px; max-height: auto; overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(0, 209, 255, 0.4) rgba(14, 20, 36, 0.5);">
                <div id="buyOrderList" style="font-size: 12px; color: #e6eefc;">
                  <div class="text-center text-muted py-2">매수 내역이 없습니다</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 9: 매도 완료 카드 -->
        <div class="col-12 col-lg-6">
          <div class="step9-container">
            <div class="card border-danger rounded-3 p-3" style="background: linear-gradient(135deg, rgba(246,70,93,0.1), rgba(246,70,93,0.05)); min-height: 500px;">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h5 class="m-0" style="color: #f6465d;">💰 매도 완료</h5>
                  <small class="text-muted" id="sellStatsTime">-</small>
                </div>
                <span id="sellCount" class="badge bg-danger" style="font-size: 16px;">0</span>
              </div>

              <!-- 매도 요약 (카드 전용) -->
              <div class="row g-2 mb-3 text-center" style="font-size:12px; color:#d9e2f3;">
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">순익 %</div>
                    <div id="topAvgSell" style="font-size: 14px; font-weight: 700; color:#f6465d;">-</div>
                  </div>
                </div>
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">최저 순익%</div>
                    <div id="topMaxSell" style="font-size: 14px; font-weight: 700; color:#ffb703;">-</div>
                  </div>
                </div>
                <div class="col-4">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">최고 순익 %</div>
                    <div id="topMaxSell" style="font-size: 14px; font-weight: 700; color:#ffb703;">-</div>
                  </div>
                </div>
              </div>
              
              <div class="row g-2 mb-3">
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">총 매도 금액</div>
                    <div id="sellTotalAmount" style="font-size: 14px; font-weight: 700; color: #f6465d;">0 KRW</div>
                  </div>
                </div>
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">평균 매도가</div>
                    <div id="sellAvgPrice" style="font-size: 14px; font-weight: 700; color: #f6465d;">0 KRW</div>
                  </div>
                </div>
              </div>
              
              <div class="row g-2 mb-3">
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">총 수익</div>
                    <div id="totalProfit" style="font-size: 14px; font-weight: 700;">0 KRW</div>
                  </div>
                </div>
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">수익률</div>
                    <div id="profitRate" style="font-size: 14px; font-weight: 700;">0%</div>
                  </div>
                </div>
              </div>
              
              <div class="row g-2 mb-3">
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">평균 수익</div>
                    <div id="avgProfit" style="font-size: 14px; font-weight: 700;">0 KRW</div>
                  </div>
                </div>
                <div class="col-6">
                  <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                    <div class="text-muted" style="font-size: 10px;">평균 수익률</div>
                    <div id="avgProfitRate" style="font-size: 14px; font-weight: 700;">0%</div>
                  </div>
                </div>
              </div>
              
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px; max-height: auto; overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(0, 209, 255, 0.4) rgba(14, 20, 36, 0.5);">
                <div class="text-muted mb-2" style="font-size: 11px;">최근 매도 내역</div>
                <div id="sellOrderList" style="font-size: 12px; color: #e6eefc;">
                  <div class="text-center text-muted py-2">매도 내역이 없습니다</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="/static/js/flow-dashboard.js?v=v0.0.7"></script>
</body>
</html>