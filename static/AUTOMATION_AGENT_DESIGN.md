# 8BIT Trading Bot - 완전 자동화 에이전트 설계 문서

## 📋 목차
1. [현재 시스템 분석](#현재-시스템-분석)
2. [자동화 목표](#자동화-목표)
3. [에이전트 아키텍처](#에이전트-아키텍처)
4. [의사결정 엔진](#의사결정-엔진)
5. [자동화 워크플로우](#자동화-워크플로우)
6. [상태 관리 시스템](#상태-관리-시스템)
7. [안전장치 및 제어](#안전장치-및-제어)
8. [모니터링 및 알림](#모니터링-및-알림)
9. [학습 및 적응](#학습-및-적응)
10. [구현 우선순위](#구현-우선순위)

---

## 현재 시스템 분석

### 1.1 현재 수동 작업 목록

#### 거래 제어 버튼
- ✅ Start Bot / Stop Bot
- ✅ Auto Trade Toggle
- ✅ BUY / SELL 버튼
- ✅ Clear Orders

#### 학습 및 최적화 버튼
- ✅ Train (Auto Period)
- ✅ Auto-Tune NB
- ✅ ML Train
- ✅ ML Predict
- ✅ ML Random
- ✅ ML Metrics

#### 백테스트 버튼
- ✅ Backtest
- ✅ Auto BT Toggle

#### 설정 조정 항목
- ✅ Timeframe 선택 (1m, 3m, 5m, 10m, 15m, 30m, 1h, 1D)
- ✅ Paper Mode 선택
- ✅ Order KRW 입력
- ✅ EMA Fast/Slow 값
- ✅ NB Buy/Sell Threshold
- ✅ NB Window, Pullback%, Debounce
- ✅ Forecast Window/Horizon
- ✅ SMA 50/100/200 값
- ✅ Ichimoku Tenkan/Kijun 값
- ✅ ML Trust / N/B Trust 슬라이더

#### 모니터링 버튼
- ✅ Assets Refresh
- ✅ Live Trade Preflight
- ✅ Screenshot
- ✅ Clear Log

#### 마을 시스템 버튼
- ✅ Emergency Reset
- ✅ Rest All
- ✅ Heal All
- ✅ Clear All Trades
- ✅ Generate NPC Messages

### 1.2 문제점 분석

1. **과도한 수동 개입 필요**
   - 사용자가 여러 버튼을 직접 클릭해야 함
   - 설정값을 수동으로 조정해야 함
   - 최적의 타이밍을 놓칠 수 있음

2. **의사결정 분산**
   - 여러 시스템이 독립적으로 작동
   - 통합된 의사결정 프로세스 부재
   - 일관성 없는 행동 패턴

3. **상태 관리 부족**
   - 각 시스템의 상태가 분리되어 있음
   - 전체적인 시스템 건강도 파악 어려움
   - 예측 가능한 실패 모드 부재

4. **학습 및 적응 부족**
   - 과거 성과 기반 자동 조정 없음
   - 시장 상황 변화에 대한 적응 부족
   - 최적 파라미터 자동 탐색 제한적

---

## 자동화 목표

### 2.1 핵심 목표

1. **완전 자동화**
   - 사용자 개입 최소화 (긴급 상황 제외)
   - 모든 주요 작업 자동 실행
   - 24/7 무인 운영 가능

2. **지능형 의사결정**
   - 다중 신호 통합 분석
   - 시장 상황에 따른 자동 적응
   - 리스크 기반 동적 조정

3. **자기 최적화**
   - 성과 기반 파라미터 자동 조정
   - 지속적인 학습 및 개선
   - 실패 모드에서 자동 복구

4. **투명성 및 제어**
   - 모든 자동화 작업 로깅
   - 사용자 개입 지점 명확화
   - 긴급 중단 메커니즘

### 2.2 성공 지표

- **자동화율**: 95% 이상 (사용자 개입 제외)
- **응답 시간**: 신호 발생 후 5초 이내 거래 결정
- **최적화 주기**: 파라미터 자동 조정 주기 1시간 이내
- **가용성**: 99.5% 이상 시스템 가동률
- **수익성**: 수동 운영 대비 동등 또는 우수한 성과

---

## 에이전트 아키텍처

### 3.1 전체 구조

```
┌─────────────────────────────────────────────────────────────┐
│              자동화 에이전트 (Automation Agent)                │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │         의사결정 엔진 (Decision Engine)              │   │
│  │  - 신호 통합 분석                                      │   │
│  │  - 리스크 평가                                         │   │
│  │  - 행동 결정                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                          │                                   │
│  ┌───────────────────────┼───────────────────────┐           │
│  │                       │                       │           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │  거래 에이전트 │  │  학습 에이전트 │  │  최적화 에이전트 │    │
│  │ (Trading)     │  │  (Learning)   │  │  (Optimization)│    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│         │                  │                    │            │
│  ┌──────┴──────────────────┴────────────────────┴─────┐   │
│  │         상태 관리 시스템 (State Manager)              │   │
│  │  - 시스템 상태 추적                                    │   │
│  │  - 건강도 모니터링                                     │   │
│  │  - 이벤트 로깅                                        │   │
│  └─────────────────────────────────────────────────────┘   │
│                          │                                   │
│  ┌───────────────────────┴───────────────────────┐        │
│  │         안전장치 레이어 (Safety Layer)            │        │
│  │  - 리스크 제한                                      │   │
│  │  - 긴급 중단                                        │   │
│  │  - 복구 메커니즘                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 컴포넌트 상세

#### 3.2.1 의사결정 엔진 (Decision Engine)

**역할:**
- 모든 신호를 통합하여 최종 거래 결정
- 리스크 평가 및 포지션 크기 결정
- 시장 상황에 따른 전략 선택

**입력:**
- N/B Wave 신호
- ML 모델 예측
- 촌장 가이던스
- 마을 시스템 상태
- 시장 데이터 (가격, 거래량, 변동성)

**출력:**
- 거래 액션 (BUY/SELL/HOLD)
- 포지션 크기
- 파라미터 조정 권장사항

#### 3.2.2 거래 에이전트 (Trading Agent)

**역할:**
- 자동 거래 실행
- 포지션 관리
- 주문 모니터링

**기능:**
- 신호 기반 자동 주문
- 부분 청산 관리
- 손절/익절 자동 실행
- 포지션 리밸런싱

#### 3.2.3 학습 에이전트 (Learning Agent)

**역할:**
- ML 모델 자동 학습
- 성과 분석 및 개선
- 패턴 인식 및 적응

**기능:**
- 주기적 모델 재학습 (30분마다)
- 교차 검증 기반 모델 선택
- 새로운 패턴 학습
- 모델 성능 모니터링

#### 3.2.4 최적화 에이전트 (Optimization Agent)

**역할:**
- 파라미터 자동 최적화
- 전략 튜닝
- 성과 기반 조정

**기능:**
- N/B 파라미터 자동 튜닝 (1시간마다)
- EMA 파라미터 최적화
- 임계값 자동 조정
- 백테스트 기반 검증

#### 3.2.5 상태 관리 시스템 (State Manager)

**역할:**
- 전체 시스템 상태 추적
- 건강도 모니터링
- 이벤트 로깅 및 알림

**기능:**
- 시스템 건강도 점수 계산
- 컴포넌트 상태 추적
- 이벤트 로깅
- 알림 트리거

#### 3.2.6 안전장치 레이어 (Safety Layer)

**역할:**
- 리스크 제한
- 긴급 상황 대응
- 시스템 보호

**기능:**
- 최대 손실 제한
- 포지션 크기 제한
- 긴급 중단 메커니즘
- 자동 복구 프로세스

---

## 의사결정 엔진

### 4.1 의사결정 프로세스

```
[신호 수집]
    ↓
[신호 통합 및 가중치 계산]
    ↓
[리스크 평가]
    ↓
[행동 결정]
    ├─ 거래 액션
    ├─ 포지션 크기
    └─ 파라미터 조정
    ↓
[실행 및 모니터링]
```

### 4.2 신호 통합 알고리즘

#### 4.2.1 신호 소스

1. **N/B Wave 신호** (가중치: 40%)
   - BLUE 존 → BUY 신호
   - ORANGE 존 → SELL 신호
   - 신호 강도: N/B 값의 편차

2. **ML 모델 예측** (가중치: 30%)
   - 확률 기반 예측
   - 신뢰도 점수
   - 시간프레임별 예측 통합

3. **촌장 가이던스** (가중치: 20%)
   - 마을 시스템 종합 판단
   - 길드 멤버 의견 통합
   - 에너지 상태 고려

4. **기술적 지표** (가중치: 10%)
   - EMA 크로스오버
   - SMA 위치
   - 거래량 패턴

#### 4.2.2 통합 점수 계산

```
최종 점수 = (N/B 점수 × 0.4) + 
            (ML 점수 × 0.3) + 
            (촌장 점수 × 0.2) + 
            (기술적 지표 점수 × 0.1)

BUY 결정: 최종 점수 > 0.6
SELL 결정: 최종 점수 < 0.4
HOLD: 0.4 ≤ 최종 점수 ≤ 0.6
```

### 4.3 리스크 평가

#### 4.3.1 리스크 지표

1. **변동성 리스크**
   - 최근 변동성 (ATR 기반)
   - 변동성 급증 감지
   - 변동성 임계값 초과 시 거래 제한

2. **포지션 리스크**
   - 현재 포지션 크기
   - 최대 포지션 한도
   - 포지션 집중도

3. **연속 손실 리스크**
   - 최근 연속 손실 횟수
   - 일일 손실 한도
   - 주간 손실 한도

4. **시장 리스크**
   - 시장 상황 (트렌드/횡보/변동)
   - 거래량 이상
   - 가격 급등/급락

#### 4.3.2 리스크 기반 포지션 크기 조정

```
기본 포지션 크기 = Order KRW 설정값

리스크 조정 계수:
- 변동성 높음: × 0.5
- 연속 손실 3회 이상: × 0.3
- 일일 손실 한도 80% 도달: × 0.2
- 시장 이상 상황: × 0.1

최종 포지션 크기 = 기본 포지션 크기 × 리스크 조정 계수
```

### 4.4 행동 결정 규칙

#### 4.4.1 거래 액션 결정

```
IF 최종 점수 > 0.7 AND 리스크 점수 < 0.3:
    → 강한 BUY 신호
    → 포지션 크기: 기본값 × 1.2

ELSE IF 최종 점수 > 0.6 AND 리스크 점수 < 0.5:
    → 일반 BUY 신호
    → 포지션 크기: 기본값

ELSE IF 최종 점수 < 0.3 AND 리스크 점수 < 0.3:
    → 강한 SELL 신호
    → 청산 비율: 80%

ELSE IF 최종 점수 < 0.4 AND 리스크 점수 < 0.5:
    → 일반 SELL 신호
    → 청산 비율: 50%

ELSE:
    → HOLD (거래 없음)
```

#### 4.4.2 존-사이드 규칙 적용

```
IF 현재 존 = BLUE:
    → SELL 신호 무시
    → BUY 신호만 허용

IF 현재 존 = ORANGE:
    → BUY 신호 무시
    → SELL 신호만 허용
```

---

## 자동화 워크플로우

### 5.1 시스템 시작 시퀀스

```
1. 시스템 초기화
   ├─ 서버 연결 확인
   ├─ 업비트 API 연결 확인
   ├─ 데이터베이스 초기화
   └─ 상태 관리 시스템 시작

2. 자동 설정 로드
   ├─ 마지막 성공 설정 불러오기
   ├─ 파라미터 초기화
   └─ 모델 로드

3. 초기 상태 확인
   ├─ 잔고 조회
   ├─ 현재 포지션 확인
   ├─ 시장 데이터 수집
   └─ 건강도 점수 계산

4. 자동화 모드 활성화
   ├─ 거래 에이전트 시작
   ├─ 학습 에이전트 시작
   ├─ 최적화 에이전트 시작
   └─ 모니터링 시작
```

### 5.2 주기적 작업 스케줄

#### 5.2.1 실시간 작업 (30초마다)

- 시장 데이터 업데이트
- 신호 재계산
- 포지션 모니터링
- 건강도 점수 업데이트

#### 5.2.2 거래 결정 (5초마다)

- 신호 통합 분석
- 리스크 평가
- 거래 액션 결정
- 주문 실행 (필요시)

#### 5.2.3 백테스트 (5분마다)

- 현재 차트 뷰 백테스트
- Win% 계산
- 성과 지표 업데이트
- 전략 검증

#### 5.2.4 ML 모델 재학습 (30분마다)

- 최신 데이터 수집
- 모델 재학습
- 교차 검증
- 모델 교체 (성능 개선 시)

#### 5.2.5 파라미터 최적화 (1시간마다)

- N/B 파라미터 그리드 서치
- EMA 파라미터 최적화
- 임계값 조정
- 백테스트로 검증

#### 5.2.6 전체 시스템 점검 (6시간마다)

- 시스템 건강도 종합 점검
- 로그 분석
- 성과 리포트 생성
- 알림 전송 (필요시)

### 5.3 이벤트 기반 작업

#### 5.3.1 신호 발생 시

```
신호 감지
    ↓
신호 통합 분석 (의사결정 엔진)
    ↓
리스크 평가
    ↓
거래 결정
    ↓
주문 실행 (거래 에이전트)
    ↓
결과 기록 및 로깅
```

#### 5.3.2 리스크 임계값 초과 시

```
리스크 감지
    ↓
긴급 중단 평가
    ↓
IF 긴급 상황:
    → 모든 거래 중단
    → 알림 전송
    → 사용자에게 보고
ELSE:
    → 포지션 크기 축소
    → 리스크 모니터링 강화
```

#### 5.3.3 모델 성능 저하 시

```
성능 모니터링
    ↓
성능 저하 감지
    ↓
자동 재학습 트리거
    ↓
새 모델 검증
    ↓
모델 교체 (성능 개선 시)
```

---

## 상태 관리 시스템

### 6.1 시스템 상태 정의

#### 6.1.1 상태 컴포넌트

1. **거래 상태**
   - 활성/비활성
   - 현재 포지션
   - 대기 중인 주문
   - 최근 거래 성과

2. **학습 상태**
   - 모델 버전
   - 마지막 학습 시간
   - 모델 성능 지표
   - 학습 진행률

3. **최적화 상태**
   - 현재 파라미터
   - 최적화 진행 중 여부
   - 마지막 최적화 시간
   - 최적화 결과

4. **시스템 건강도**
   - API 연결 상태
   - 데이터 수신 상태
   - 에러 발생률
   - 리소스 사용률

#### 6.1.2 건강도 점수 계산

```
건강도 점수 = (API 연결 점수 × 0.3) +
              (데이터 수신 점수 × 0.3) +
              (에러율 점수 × 0.2) +
              (성과 점수 × 0.2)

각 점수 범위: 0.0 ~ 1.0

건강도 등급:
- 우수 (0.9 ~ 1.0): 모든 시스템 정상
- 양호 (0.7 ~ 0.9): 경미한 문제 있음
- 보통 (0.5 ~ 0.7): 주의 필요
- 나쁨 (0.3 ~ 0.5): 문제 발생, 조치 필요
- 위험 (0.0 ~ 0.3): 긴급 중단 권장
```

### 6.2 상태 전이 다이어그램

```
[초기화]
    ↓
[준비 중]
    ↓
[자동화 활성화]
    ↓
[정상 운영]
    ├─ [경고 상태] (건강도 0.5~0.7)
    │   └─ [정상 운영] (복구 시)
    │
    └─ [위험 상태] (건강도 < 0.3)
        └─ [긴급 중단]
            └─ [수동 개입 필요]
```

### 6.3 이벤트 로깅

#### 6.3.1 로그 레벨

- **INFO**: 일반 정보 (상태 변경, 정상 작업)
- **WARNING**: 경고 (성능 저하, 임계값 근접)
- **ERROR**: 오류 (작업 실패, 연결 끊김)
- **CRITICAL**: 긴급 (시스템 중단, 큰 손실)

#### 6.3.2 로그 항목

- 타임스탬프
- 이벤트 유형
- 컴포넌트
- 메시지
- 관련 데이터 (JSON)
- 건강도 점수

---

## 안전장치 및 제어

### 7.1 리스크 제한

#### 7.1.1 손실 제한

- **일일 최대 손실**: 총 자산의 5%
- **주간 최대 손실**: 총 자산의 10%
- **월간 최대 손실**: 총 자산의 20%
- **연속 손실 제한**: 5회 연속 손실 시 중단

#### 7.1.2 포지션 제한

- **최대 포지션 크기**: 총 자산의 30%
- **단일 코인 최대**: 총 자산의 15%
- **최소 주문 금액**: 5,000 KRW (업비트 제한)

#### 7.1.3 변동성 제한

- **변동성 임계값**: 최근 24시간 평균의 200%
- **급등/급락 감지**: 5분 내 10% 이상 변동
- **거래량 이상**: 평균 대비 500% 이상

### 7.2 긴급 중단 메커니즘

#### 7.2.1 자동 중단 조건

1. **건강도 점수 < 0.3**
2. **일일 손실 한도 도달**
3. **연속 손실 5회 이상**
4. **API 연결 끊김 5분 이상**
5. **시장 급변동 감지**

#### 7.2.2 중단 프로세스

```
긴급 상황 감지
    ↓
모든 거래 즉시 중단
    ↓
대기 중인 주문 취소
    ↓
현재 포지션 확인
    ↓
알림 전송 (이메일/텔레그램)
    ↓
상태 로깅
    ↓
사용자 개입 대기
```

### 7.3 복구 메커니즘

#### 7.3.1 자동 복구

- **API 재연결**: 자동 재시도 (최대 3회)
- **데이터 수신 복구**: 자동 재시작
- **경미한 오류**: 자동 복구 후 재개

#### 7.3.2 수동 복구 필요

- **큰 손실 발생**: 사용자 확인 필요
- **시스템 오류**: 로그 확인 후 수동 재시작
- **파라미터 이상**: 설정 재검토 필요

### 7.4 사용자 제어 지점

#### 7.4.1 완전 자동화 모드

- 모든 결정 자동
- 사용자 개입 불필요
- 모니터링만 필요

#### 7.4.2 반자동 모드

- 주요 결정은 자동
- 큰 거래는 사용자 승인 필요
- 파라미터 조정은 사용자

#### 7.4.3 수동 모드

- 모든 결정은 사용자
- 자동화는 모니터링만
- 거래는 수동 실행

---

## 모니터링 및 알림

### 8.1 실시간 모니터링

#### 8.1.1 대시보드

- **시스템 건강도**: 실시간 점수 및 그래프
- **거래 현황**: 현재 포지션, 최근 거래
- **성과 지표**: 수익률, Win%, Sharpe Ratio
- **알림 목록**: 최근 경고 및 오류

#### 8.1.2 차트 및 그래프

- 건강도 추이 (시간별)
- 수익률 추이 (일별/주별/월별)
- 거래 빈도
- 리스크 지표

### 8.2 알림 시스템

#### 8.2.1 알림 레벨

1. **정보**: 일반 상태 변경
2. **경고**: 주의 필요 상황
3. **오류**: 문제 발생
4. **긴급**: 즉시 조치 필요

#### 8.2.2 알림 채널

- **UI 알림**: 실시간 대시보드 표시
- **이메일**: 중요 이벤트
- **텔레그램**: 긴급 상황 (선택적)
- **로그 파일**: 모든 이벤트 기록

#### 8.2.3 알림 조건

- 건강도 점수 < 0.5
- 일일 손실 한도 80% 도달
- 연속 손실 3회 이상
- API 연결 끊김
- 큰 거래 실행
- 파라미터 자동 조정

### 8.3 리포트 생성

#### 8.3.1 일일 리포트

- 거래 요약
- 수익/손실
- 건강도 점수
- 주요 이벤트

#### 8.3.2 주간 리포트

- 성과 분석
- 전략 평가
- 파라미터 변경 내역
- 개선 권장사항

#### 8.3.3 월간 리포트

- 종합 성과
- 리스크 분석
- 모델 성능 평가
- 시스템 개선 제안

---

## 학습 및 적응

### 9.1 성과 기반 학습

#### 9.1.1 성과 추적

- 거래별 수익/손실
- 전략별 성과
- 파라미터별 성과
- 시장 상황별 성과

#### 9.1.2 패턴 인식

- 성공 패턴 학습
- 실패 패턴 회피
- 시장 상황별 최적 전략
- 시간대별 성과 패턴

### 9.2 자동 파라미터 조정

#### 9.2.1 조정 주기

- **빠른 조정**: 1시간마다 (N/B 파라미터)
- **중간 조정**: 6시간마다 (EMA 파라미터)
- **느린 조정**: 24시간마다 (전략 파라미터)

#### 9.2.2 조정 방법

- 그리드 서치
- 베이지안 최적화
- 성과 기반 선택
- 백테스트 검증

### 9.3 적응형 전략

#### 9.3.1 시장 상황 감지

- **트렌드 시장**: 추세 추종 전략
- **횡보 시장**: 범위 거래 전략
- **변동성 시장**: 변동성 기반 전략

#### 9.3.2 전략 전환

- 시장 상황 변화 감지
- 최적 전략 자동 선택
- 부드러운 전환 (급격한 변경 방지)

---

## 구현 우선순위

### 10.1 Phase 1: 핵심 자동화 (1-2주)

**목표**: 기본 자동 거래 및 모니터링

1. ✅ 의사결정 엔진 구현
2. ✅ 거래 에이전트 구현
3. ✅ 상태 관리 시스템 기본
4. ✅ 안전장치 레이어 기본

**결과**: 완전 자동 거래 가능, 기본 모니터링

### 10.2 Phase 2: 학습 및 최적화 (2-3주)

**목표**: 자동 학습 및 파라미터 최적화

1. ✅ 학습 에이전트 구현
2. ✅ 최적화 에이전트 구현
3. ✅ 성과 추적 시스템
4. ✅ 자동 파라미터 조정

**결과**: 자동 학습 및 최적화 가능

### 10.3 Phase 3: 고급 기능 (3-4주)

**목표**: 적응형 전략 및 고급 모니터링

1. ✅ 적응형 전략 시스템
2. ✅ 고급 모니터링 대시보드
3. ✅ 알림 시스템 고도화
4. ✅ 리포트 자동 생성

**결과**: 완전 자동화 시스템 완성

### 10.4 Phase 4: 최적화 및 안정화 (지속적)

**목표**: 성능 최적화 및 안정성 향상

1. ✅ 성능 튜닝
2. ✅ 버그 수정
3. ✅ 사용자 피드백 반영
4. ✅ 문서화

**결과**: 프로덕션 준비 완료

---

## 부록

### A. 기술 스택 제안

- **의사결정 엔진**: Python (NumPy, Pandas)
- **상태 관리**: Redis 또는 SQLite
- **모니터링**: Grafana + InfluxDB (선택적)
- **알림**: SMTP (이메일), Telegram Bot API

### B. 설정 파일 구조

```json
{
  "automation": {
    "enabled": true,
    "mode": "full_auto",
    "trading": {
      "max_daily_loss": 0.05,
      "max_position_size": 0.30,
      "min_order_krw": 5000
    },
    "learning": {
      "retrain_interval_minutes": 30,
      "optimization_interval_hours": 1
    },
    "safety": {
      "health_threshold": 0.3,
      "max_consecutive_losses": 5
    }
  }
}
```

### C. API 엔드포인트 제안

- `POST /api/automation/start` - 자동화 시작
- `POST /api/automation/stop` - 자동화 중지
- `GET /api/automation/status` - 자동화 상태
- `GET /api/automation/health` - 건강도 점수
- `POST /api/automation/config` - 설정 변경

---

**문서 버전**: 1.0  
**작성일**: 2025-12-17  
**작성자**: 8BIT Trading Bot Team

