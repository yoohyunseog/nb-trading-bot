<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>8BIT Upbit Bot UI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    html, body{ overflow-anchor: none; }
    body{background:#0b1220;color:#ffffff;font-family:-apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;font-size:14px}
    .card{background:#1e2329;border:1px solid rgba(255,255,255,0.08)}
    #tvChart{width:80%;height:82vh;min-height:460px}
    .kv{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed rgba(255,255,255,0.08)}
    .buy{color:#0ecb81}.sell{color:#f6465d}
    @media (max-width: 991px){ #tvChart{height:70vh} }
    .toolbar .form-control,.toolbar .form-select{color:#ffffff;background:#2b3139;border:1px solid rgba(255,255,255,0.2)}
    .toolbar .btn{color:#ffffff}
    .form-check-label{color:#e0e7ff}
    .kv span:first-child{color:#ffffff}
    .kv span:last-child{color:#ffffff;font-weight:700}
    .badge{color:#ffffff}
    .text-muted{color:#ffffff !important}
    /* Assets UI */
    .asset-stat{background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:10px}
    .asset-stat .label{color:#ffffff;font-size:12px}
    .asset-stat .value{color:#ffffff;font-size:20px;font-weight:700}
    .asset-bars{display:flex;flex-direction:column;gap:8px}
    .asset-bar .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .asset-bar .label{color:#ffffff;font-weight:600}
    .asset-bar .muted{color:#ffffff;font-size:12px;margin-left:8px}
    .asset-bar .meter{height:10px;border-radius:6px;background:#10182a;overflow:hidden;border:1px solid rgba(255,255,255,0.08)}
    .asset-bar .fill{height:100%;background:linear-gradient(90deg,#0ecb81,#2bdab5)}
    .asset-bar.krw .fill{background:linear-gradient(90deg,#4285f4,#72a6ff)}
    .chip{display:inline-block;padding:3px 8px;margin:2px;border-radius:999px;background:#2b3139;border:1px solid rgba(255,255,255,0.12);font-size:12px;color:#ffffff}
    .chip-selected{background:#0ecb81;color:#0b1220;border-color:#0ecb81;font-weight:700}
    .chip-muted{background:#2b3139;color:#9ba4b5;border-color:rgba(255,255,255,0.08);opacity:0.65}
    /* Win list */
    #winList{display:flex;flex-direction:column;gap:6px;overflow-y:auto;overflow-x:hidden}
    #winList{scrollbar-width:none;-ms-overflow-style:none}
    #winList::-webkit-scrollbar{width:0;height:0}
    /* Win card scroll hide scrollbar */
    #winCard{scrollbar-width:none;-ms-overflow-style:none}
    #winCard::-webkit-scrollbar{width:0;height:0}
    .win-chip{display:flex;flex-direction:column;align-items:flex-start;gap:4px;text-align:left;border:1px solid rgba(255,255,255,0.15);border-radius:8px;padding:6px 10px;color:#ffffff;background:#1b2437;transition:transform .2s ease, box-shadow .2s ease;min-height:32px}
    .win-chip.positive{background:linear-gradient(90deg,rgba(14,203,129,0.35),rgba(14,203,129,0.10));}
    .win-chip.negative{background:linear-gradient(90deg,rgba(246,70,93,0.35),rgba(246,70,93,0.10));}
    .win-chip:hover{transform:translateY(-1px); box-shadow:0 4px 10px rgba(0,0,0,0.35)}
    .win-chip .meta{font-size:11px;color:#d9e2f3;line-height:1.3;text-align:left}
    .win-chip .val{font-weight:700;white-space:normal;word-break:break-word;flex:1}
    /* Zone badge on win buttons */
    .zone-badge{display:inline-block;padding:2px 6px;border-radius:999px;font-size:11px;font-weight:700;color:#0b1220}
    .zone-blue{background:#00d1ff;color:#0b1220}
    .zone-orange{background:#ffb703;color:#0b1220}
    
    /* Zone display improvements */
    .zone-display-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .zone-display-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    
    .zone-display-label {
      font-size: 10px;
      color: #888888;
      font-weight: 500;
    }
    
    .zone-display-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .zone-divider {
      width: 1px;
      height: 20px;
      background: rgba(255,255,255,0.2);
    }
    
    .zone-stats {
      font-size: 11px;
      color: #ffffff;
      font-weight: 500;
    }
    
    /* ë¶„ë´‰ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .timeframe-cards-container {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 5px 0;
    }
    
    .timeframe-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      min-width: 80px;
      background: rgba(52, 73, 94, 0.8);
      border: 1px solid #34495e;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .timeframe-card:hover {
      background: rgba(52, 152, 219, 0.3);
      border-color: #3498db;
      transform: translateY(-2px);
    }
    
    .timeframe-card.active {
      background: rgba(52, 152, 219, 0.5);
      border-color: #3498db;
      box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
    }
    
    .timeframe-icon {
      font-size: 20px;
      margin-bottom: 5px;
    }
    
    .timeframe-name {
      font-weight: bold;
      color: #ecf0f1;
      font-size: 14px;
      margin-bottom: 3px;
    }
    
    .timeframe-status {
      font-size: 10px;
      color: #2ecc71;
      font-weight: 500;
    }
    
         .timeframe-card:not(.active) .timeframe-status {
       color: #95a5a6;
     }
     
           /* í•˜ë‹¨ ë¶„ë´‰ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
      .timeframe-cards-container-bottom {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding: 5px 0;
        justify-content: center;
        min-height: 80px;
      }
      
      .timeframe-card-bottom {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px;
        min-width: 70px;
        background: rgba(52, 73, 94, 0.8);
        border: 1px solid #34495e;
        border-radius: 6px;
        transition: all 0.3s ease;
        cursor: pointer;
        flex-shrink: 0;
        height: 60px;
        justify-content: center;
      }
      
      .timeframe-card-bottom:hover {
        background: rgba(52, 152, 219, 0.3);
        border-color: #3498db;
        transform: translateY(-2px);
      }
      
      .timeframe-card-bottom.active {
        background: rgba(52, 152, 219, 0.5);
        border-color: #3498db;
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
      }
      
      .timeframe-icon-bottom {
        font-size: 16px;
        margin-bottom: 3px;
        color: #ecf0f1;
      }
      
      .timeframe-name-bottom {
        font-weight: bold;
        color: #ecf0f1;
        font-size: 12px;
        margin-bottom: 2px;
      }
      
      .timeframe-status-bottom {
        font-size: 9px;
        color: #2ecc71;
        font-weight: 500;
      }
      
      .timeframe-card-bottom:not(.active) .timeframe-status-bottom {
        color: #95a5a6;
      }
    /* Win card zone theming */
    .win-card-blue{background:linear-gradient(180deg,rgba(0,209,255,0.12),rgba(0,209,255,0.04)) !important}
    .win-card-orange{background:linear-gradient(180deg,rgba(255,183,3,0.12),rgba(255,183,3,0.04)) !important}
    /* PnL slider glow */
    @keyframes glowGreen { 0%{ box-shadow:0 0 0 rgba(14,203,129,0);} 50%{ box-shadow:0 0 12px rgba(14,203,129,0.8);} 100%{ box-shadow:0 0 0 rgba(14,203,129,0);} }
    @keyframes glowRed { 0%{ box-shadow:0 0 0 rgba(246,70,93,0);} 50%{ box-shadow:0 0 12px rgba(246,70,93,0.8);} 100%{ box-shadow:0 0 0 rgba(246,70,93,0);} }
    .glow-green{ animation: glowGreen .9s ease; }
    .glow-red{ animation: glowRed .9s ease; }
    #pnlLeftLabel,#pnlRightLabel{ color:#ffffff }
    /* Masonry cards animation */
    .nb-coin-item{ transition: transform .3s ease, width .3s ease, height .3s ease, opacity .3s ease; will-change: transform; }
    /* Speech bubble */
    .nb-bubble{ position:relative; background:#1b2437; border:1px solid rgba(255,255,255,0.15); border-radius:12px; padding:8px 10px; color:#ffffff; font-size:12px }
    .nb-bubble:after{ content:""; position:absolute; bottom:-6px; left:18px; border-width:6px 6px 0 6px; border-style:solid; border-color:rgba(255,255,255,0.15) transparent transparent transparent }
    .nb-bubble:before{ content:""; position:absolute; bottom:-5px; left:19px; border-width:5px 5px 0 5px; border-style:solid; border-color:#1b2437 transparent transparent transparent }
    
    /* Auto Trading Status Styles */
    .auto-trading-status {
      background: #0e1424;
      border-radius: 8px;
      padding: 12px;
    }
    
    .auto-trading-status h4 {
      color: #ffffff;
      font-size: 14px;
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .member-auto-status {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 12px;
    }
    
    .member-auto-status:last-child {
      border-bottom: none;
    }
    
    .member-auto-status span {
      color: #ffffff;
    }
    
    .member-auto-status span:first-child {
      font-weight: 600;
      flex: 1;
    }
    
    .member-auto-status span:nth-child(2) {
      margin: 0 12px;
      font-size: 11px;
    }
    
    .member-auto-status span:last-child {
      font-size: 11px;
      color: #d9e2f3;
    }
    
    /* ìë™í™” ëª¨ë“œ í‘œì‹œ (ì„ íƒì ) */
    .auto-mode-indicator {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(14, 203, 129, 0.2);
      border: 1px solid #0ecb81;
      border-radius: 8px;
      padding: 8px 16px;
      color: #0ecb81;
      font-size: 12px;
      font-weight: 600;
      z-index: 10000;
      backdrop-filter: blur(10px);
      display: none; /* í•„ìš”ì‹œ í‘œì‹œ */
    }
    
    /* ë¶„ë´‰ ìˆœíšŒ í”„ë¡œê·¸ë ˆìŠ¤ë°” ìŠ¤íƒ€ì¼ */
    #timeframeCycleProgress {
      box-shadow: 0 0 10px rgba(0, 209, 255, 0.3);
      animation: progressGlow 2s ease-in-out infinite;
    }
    
    @keyframes progressGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(0, 209, 255, 0.3); }
      50% { box-shadow: 0 0 20px rgba(0, 209, 255, 0.6); }
    }
    
    #timeframeCycleProgress[style*="width: 100%"] {
      animation: progressComplete 0.5s ease-in-out;
    }
    
    @keyframes progressComplete {
      0% { background: linear-gradient(90deg, #00d1ff, #4285f4); }
      50% { background: linear-gradient(90deg, #0ecb81, #2bdab5); }
      100% { background: linear-gradient(90deg, #00d1ff, #4285f4); }
    }
  </style>
</head>
<body class="text-white">
  <div class="container-fluid py-3">

    
    <div class="row g-3 justify-content-center">
      <div class="col-12 mt-3">
        <!-- ë¶„ë´‰ ì„ íƒ ì¹´ë“œ (ê¸°ì¡´ í•˜ë‹¨ ì¹´ë“œ ì´ë™) -->
        <div class="card border-secondary rounded-3 p-3 mb-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <strong class="text-white">ë¶„ë´‰ ì„ íƒ</strong>
            <div class="d-flex align-items-center gap-2">
              <button id="btnAutoRotateBottom" class="btn btn-sm btn-outline-info">ìë™ ìˆœíšŒ</button>
              <span id="currentTimeframeBottom" class="badge bg-primary">10m</span>
            </div>
          </div>
          <div class="timeframe-cards-container-bottom">
            <div class="timeframe-card-bottom" data-timeframe="minute1">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">1m</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="minute3">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">3m</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="minute5">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">5m</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom active" data-timeframe="minute10">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">10m</div>
              <div class="timeframe-status-bottom">í™œì„±</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="minute15">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">15m</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="minute30">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">30m</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="minute60">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">1h</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
            <div class="timeframe-card-bottom" data-timeframe="day">
              <div class="timeframe-icon-bottom">â±ï¸</div>
              <div class="timeframe-name-bottom">1D</div>
              <div class="timeframe-status-bottom">ëŒ€ê¸°</div>
            </div>
          </div>
        </div>

    <!-- Global Profit/Loss slider (uses Win% from backtest) -->
    <div class="card border-secondary rounded-3 p-2 mb-3">
      <div class="pnl-track" style="height:14px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:10px; overflow:hidden; position:relative">
        <div id="pnlCenter" style="position:absolute; left:50%; top:0; width:2px; height:100%; background:#ffffff"></div>
        <div id="pnlLeftBar" style="position:absolute; right:50%; top:0; height:100%; width:0%; background:linear-gradient(90deg, rgba(14,203,129,0.9), rgba(14,203,129,0.45)); transition:width .6s ease"></div>
        <div id="pnlRightBar" style="position:absolute; left:50%; top:0; height:100%; width:0%; background:linear-gradient(90deg, rgba(246,70,93,0.45), rgba(246,70,93,0.9)); transition:width .6s ease"></div>
      </div>
      <div class="d-flex justify-content-between mt-1" style="font-size:12px">
        <div id="pnlLeftLabel">Profit 0%</div>
        <div id="pnlRightLabel">Loss 100%</div>
      </div>
      <div class="mt-2">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="text-muted" style="font-size:12px">AutoTrade Readiness</span>
          <span id="autoGaugeText" class="badge bg-secondary">-</span>
        </div>
        <div style="height:8px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden;">
          <div id="autoGaugeBar" style="height:100%; width:0%; background:linear-gradient(90deg,#2bdab5,#0ecb81); transition:width .4s ease"></div>
        </div>
      </div>
      
      <!-- Information Trust Sliders -->
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-muted" style="font-size:12px">Information Trust Level</span>
          <span id="trustStatusText" class="badge bg-info">Balanced</span>
        </div>
        
        <!-- ML Model Trust Slider -->
        <div class="mb-2">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="text-muted" style="font-size:11px">ğŸ¤– ML Model Trust</span>
            <span id="mlTrustValue" class="badge bg-primary" style="font-size:10px">50%</span>
          </div>
          <div style="height:6px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:4px; overflow:hidden; position:relative;">
            <div id="mlTrustBar" style="height:100%; width:50%; background:linear-gradient(90deg,#4285f4,#72a6ff); transition:width .3s ease"></div>
            <input type="range" id="mlTrustSlider" min="0" max="100" value="50" style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
          </div>
        </div>
        
        <!-- N/B Guild Trust Slider -->
        <div class="mb-2">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="text-muted" style="font-size:11px">ğŸ›ï¸ N/B Guild Trust</span>
            <span id="nbTrustValue" class="badge bg-warning" style="font-size:10px">50%</span>
          </div>
          <div style="height:6px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:4px; overflow:hidden; position:relative;">
            <div id="nbTrustBar" style="height:100%; width:50%; background:linear-gradient(90deg,#ffb703,#ffd54f); transition:width .3s ease"></div>
            <input type="range" id="nbTrustSlider" min="0" max="100" value="50" style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
          </div>
        </div>
        
        <!-- Trust Balance Indicator -->
        <div class="mt-2">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted" style="font-size:10px">Trust Balance</span>
            <span id="trustBalanceText" class="text-muted" style="font-size:10px">ML: 50% | N/B: 50%</span>
          </div>
        </div>
      </div>
      
      <!-- ë¶„ë´‰ ìˆœíšŒ í”„ë¡œê·¸ë ˆìŠ¤ë°” -->
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted" style="font-size:12px">ë¶„ë´‰ ìë™ ìˆœíšŒ</span>
            <span id="timeframeCycleStatus" class="badge bg-success" style="font-size:10px">í™œì„±</span>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span id="currentTimeframeDisplay" class="badge bg-primary" style="font-size:11px">10m</span>
            <span id="nextTimeframeDisplay" class="text-muted" style="font-size:11px">â†’ 15m</span>
          </div>
        </div>
        <div style="height:16px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:8px; overflow:hidden; position:relative">
          <div id="timeframeCycleProgress" style="height:100%; width:0%; background:linear-gradient(90deg, #00d1ff, #4285f4); transition:width 0.1s linear; position:relative">
            <div style="position:absolute; right:0; top:0; bottom:0; width:2px; background:#ffffff; opacity:0.5"></div>
          </div>
          <div id="timeframeCycleText" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:11px; font-weight:600; color:#ffffff; text-shadow:0 0 4px rgba(0,0,0,0.8); pointer-events:none">
            <span id="timeframeCyclePercent">0%</span>
          </div>
        </div>
        <div class="d-flex justify-content-between mt-1" style="font-size:10px">
          <span class="text-muted">ìˆœíšŒ ì‹œê°„: <span id="timeframeCycleDuration">30</span>ì´ˆ</span>
          <button id="toggleTimeframeCycle" class="btn btn-sm btn-outline-secondary" style="padding:2px 8px; font-size:10px">ì¼ì‹œì •ì§€</button>
        </div>
      </div>
      
      <!-- N/B Zone Strip -->
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted" style="font-size:12px">N/B Zone Status</span>
            <span id="nbZoneTimeframe" class="badge bg-info" style="font-size:10px">-</span>
          </div>
          <span id="nbZoneNow" class="badge bg-secondary">-</span>
        </div>
        <div id="nbZoneStrip" style="height:12px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden; display:flex; align-items:center; padding:2px">
          <div class="text-muted" style="font-size:11px; padding-left:6px">Loadingâ€¦</div>
        </div>
                      <div class="text-white" style="font-size:11px; margin-top:4px">Visible chart zones (left=older â†’ right=newer)</div>
      </div>

      <!-- Integrated Guild Members & Auto Trading -->
      <div class="mt-3 d-none">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <strong class="text-white" style="font-size:12px">ğŸ° Guild Members</strong>
        </div>
        <div id="integratedGuildStatus" class="mt-1" style="font-size:12px; color:#ffffff; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; padding:8px; min-height:22px">
          <div class="text-muted" style="font-size:11px">Guild ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">8BIT Upbit Bot - Chart</h3>
      <div class="d-flex align-items-center gap-3">
        <!-- Wave Counter -->
        <div class="d-flex align-items-center gap-2">
          <div class="d-flex align-items-center gap-1">
            <span class="badge bg-primary" style="font-size: 10px;">Blue Wave</span>
            <span id="blueWaveCount" class="badge bg-info" style="font-size: 10px;">5</span>
          </div>
          <div class="d-flex align-items-center gap-1">
            <span class="badge bg-warning" style="font-size: 10px;">Orange Wave</span>
            <span id="orangeWaveCount" class="badge bg-info" style="font-size: 10px;">3</span>
          </div>
          <div class="d-flex align-items-center gap-1">
            <span class="badge bg-secondary" style="font-size: 10px;">Last</span>
            <span id="lastWaveType" class="badge bg-primary" style="font-size: 10px;">BLUE</span>
          </div>
        </div>
        <div class="text-muted" id="meta">-</div>
      </div>
    </div>

    <!-- Top Status + Layout switch: chart left, assets right -->
    <div class="row g-3 align-items-stretch mb-3">
      <div class="col-12 col-lg-2">
        <div id="winCard" class="card border-secondary rounded-3 p-3 h-100 d-flex flex-column win-card-orange" style="overflow-y:auto; scrollbar-width:none; max-height:920px;">
          <div class="mb-2">
            <strong class="text-white">Win%</strong>
          </div>
          
          <!-- Zone display - col-12 layout -->
          <div class="row g-2 mb-3">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center">
                <span class="zone-display-label">25ê°œ íˆìŠ¤í† ë¦¬</span>
                <span id="winMajor" class="badge bg-white text-dark zone-display-badge">-</span>
              </div>
            </div>
            <div class="col-12">
              <div id="zoneConsistencyInfo" style="font-size: 10px; color: #888;">
                <!-- Zone consistency info will be displayed here -->
              </div>
            </div>
          </div>
          <div id="winFillTrack" style="height:6px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:6px; overflow:hidden; margin-bottom:8px;">
            <div id="winFillBar" style="height:100%; width:1%; background:#ffffff; transition:width .4s ease"></div>
          </div>
          <div id="winList" class="flex-grow-1" style="overflow-y:auto;overflow-x:hidden;"></div>
        </div>
      </div>
      <div class="col-12 col-lg-8">
         <div class="card border-secondary rounded-3 h-100">
           <div class="card-body">
             <div id="tvChart" class="mt-2" style="width: 99%; margin: 0 auto;"></div>
            <div class="mt-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <strong class="text-white">Model Narrative (EN)</strong>
                <span id="nbNarrativeBadge" class="badge bg-secondary">-</span>
              </div>
              <div id="nbNarrative" style="font-size:13px; color:#e6eefc; background:#0e1424; border:1px solid rgba(255,255,255,0.1); border-radius:6px; padding:10px; min-height:52px">-</div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-2">
        <div id="currentCard" class="card border-secondary rounded-3 p-3 h-100 d-flex flex-column" style="min-height:240px; background: linear-gradient(135deg, rgba(30,35,41,0.9), rgba(14,20,36,0.9));">
          <!-- í—¤ë” -->
          <div class="d-flex justify-content-between align-items-center mb-3" style="border-bottom: 2px solid rgba(0,209,255,0.3); padding-bottom: 10px;">
            <div>
              <strong class="text-white" style="font-size: 16px;">ğŸ“Š í˜„ì¬ ì¹´ë“œ</strong>
              <div class="text-muted" style="font-size: 10px; margin-top: 2px;" id="ccTimestamp">-</div>
            </div>
            <span id="ccInterval" class="badge bg-info" style="font-size: 10px; padding: 4px 8px;">-</span>
          </div>
          
          <!-- í˜„ì¬ ê°€ê²© ì„¹ì…˜ (ê°•ì¡°) -->
          <div style="background: rgba(0,209,255,0.1); border-radius: 8px; padding: 12px; margin-bottom: 12px; border: 1px solid rgba(0,209,255,0.3);">
            <div class="text-muted" style="font-size: 10px; margin-bottom: 4px;">í˜„ì¬ ê°€ê²©</div>
            <div id="ccPrice" style="font-size: 20px; font-weight: 700; color: #00d1ff; word-break: break-all;">-</div>
          </div>
          
          <!-- ê±°ë˜ëŸ‰ & ê±°ë˜ëŒ€ê¸ˆ ì„¹ì…˜ -->
          <div class="row g-2" style="margin-bottom: 12px;">
            <div class="col-6">
              <div style="background: rgba(14,203,129,0.1); border-radius: 8px; padding: 10px; border: 1px solid rgba(14,203,129,0.3);">
                <div class="text-muted" style="font-size: 9px; margin-bottom: 4px;">ê±°ë˜ëŸ‰</div>
                <div id="ccVolume" style="font-size: 14px; font-weight: 700; color: #0ecb81; word-break: break-all;">-</div>
              </div>
            </div>
            <div class="col-6">
              <div style="background: rgba(66,133,244,0.1); border-radius: 8px; padding: 10px; border: 1px solid rgba(66,133,244,0.3);">
                <div class="text-muted" style="font-size: 9px; margin-bottom: 4px;">ê±°ë˜ëŒ€ê¸ˆ</div>
                <div id="ccTurnover" style="font-size: 14px; font-weight: 700; color: #4285f4; word-break: break-all;">-</div>
              </div>
            </div>
          </div>
          
          <!-- ê°€ê²© N/B ì„¹ì…˜ -->
          <div style="margin-bottom: 12px;">
            <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">ğŸ’° ê°€ê²© N/B</div>
            <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted" style="font-size: 10px;">MAX</span>
                <span id="ccPriceMax" style="font-size: 11px; font-weight: 600; color: #0ecb81;">-</span>
              </div>
              <div class="d-flex justify-content-between">
                <span class="text-muted" style="font-size: 10px;">MIN</span>
                <span id="ccPriceMin" style="font-size: 11px; font-weight: 600; color: #f6465d;">-</span>
              </div>
            </div>
          </div>
          
          <!-- ê±°ë˜ëŸ‰ N/B ì„¹ì…˜ -->
          <div style="margin-bottom: 12px;">
            <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">ğŸ“ˆ ê±°ë˜ëŸ‰ N/B</div>
            <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted" style="font-size: 10px;">MAX</span>
                <span id="ccVolMax" style="font-size: 11px; font-weight: 600; color: #2bdab5;">-</span>
              </div>
              <div class="d-flex justify-content-between">
                <span class="text-muted" style="font-size: 10px;">MIN</span>
                <span id="ccVolMin" style="font-size: 11px; font-weight: 600; color: #ffb703;">-</span>
              </div>
            </div>
          </div>
          
          <!-- ê±°ë˜ëŒ€ê¸ˆ N/B ì„¹ì…˜ -->
          <div style="margin-bottom: 12px;">
            <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">ğŸ’µ ê±°ë˜ëŒ€ê¸ˆ N/B</div>
            <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1);">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted" style="font-size: 10px;">MAX</span>
                <span id="ccTurnMax" style="font-size: 11px; font-weight: 600; color: #4285f4;">-</span>
              </div>
              <div class="d-flex justify-content-between">
                <span class="text-muted" style="font-size: 10px;">MIN</span>
                <span id="ccTurnMin" style="font-size: 11px; font-weight: 600; color: #9c27b0;">-</span>
              </div>
            </div>
          </div>
          
          <!-- ìš”ì•½ ê·¸ë˜í”„ -->
          <div style="margin-bottom: 12px; position: relative; height: 80px;">
            <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">ğŸ“Š ì¶”ì´ ê·¸ë˜í”„</div>
            <canvas id="ccSummaryChart" style="position: absolute; top: 20px; left: 0; width: 100%; height: 60px !important;"></canvas>
          </div>
          
          <!-- N/B Zone Status ì„¹ì…˜ -->
          <div style="margin-bottom: 12px;">
            <div style="font-size: 11px; font-weight: 600; color: #ffffff; margin-bottom: 6px;">ğŸ—ºï¸ N/B Zone</div>
            <div id="ccNBZone" style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); font-size: 10px; color: #e6eefc; min-height: 20px; word-break: break-word;">-</div>
          </div>
          
          <!-- ë²„íŠ¼ ë° ìƒíƒœ -->
          <div class="mt-auto pt-2">
            <div style="margin-bottom: 8px;">
              <div class="d-flex align-items-center gap-2 mb-2">
                <label class="text-muted" style="font-size: 11px; white-space: nowrap;">ë§¤ìˆ˜ ê¸ˆì•¡</label>
                <input id="ccBuyAmount" type="number" value="5000" min="1000" step="1000" class="form-control form-control-sm" style="flex: 1;" />
              </div>
              <div class="d-grid gap-2">
                <button id="ccBuy" class="btn btn-sm btn-success">ğŸ›’ í˜„ì¬ ì¹´ë“œ ë§¤ìˆ˜</button>
                <button id="ccRefresh" class="btn btn-sm btn-outline-info">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
              </div>
            </div>
            <div style="background: rgba(14,20,36,0.8); border-radius: 6px; padding: 8px; border: 1px solid rgba(255,255,255,0.1); text-align: center;">
              <div class="text-muted" style="font-size: 9px; margin-bottom: 3px;">NBverse ì €ì¥</div>
              <div id="ccSaveHint" style="font-size: 11px; font-weight: 600; color: #2ecc71;">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ë§¤ìˆ˜/ë§¤ë„ í†µê³„ ì„¹ì…˜ -->
    <div class="row g-3 mb-3">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="m-0">ê±°ë˜ í†µê³„</h3>
          <button id="tradeStatsRefresh" class="btn btn-sm btn-outline-info">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>
      
    <!-- ìì‚° ìš”ì•½ -->
    <div class="card border-secondary rounded-3 p-3 mb-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center gap-2">
          <strong class="text-white">ìì‚°</strong>
          <span id="assetsMeta" class="text-muted" style="font-size:11px">-</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="form-check form-switch m-0">
            <input class="form-check-input" type="checkbox" id="assetsAuto" checked>
            <label class="form-check-label text-muted" for="assetsAuto" style="font-size:11px">ìë™</label>
          </div>
          <button id="assetsRefresh" class="btn btn-sm btn-outline-info">ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>

      <div class="row g-2 mb-3">
        <div class="col-12 col-md-4">
          <div class="asset-stat">
            <div class="label">ì´ ìì‚° (KRW í™˜ì‚°)</div>
            <div class="value" id="assetTotal">-</div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="asset-stat">
            <div class="label">ë³´ìœ  KRW</div>
            <div class="value" id="assetBuyable">-</div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="asset-stat">
            <div class="label">ë§¤ë„ ê°€ëŠ¥ ì½”ì¸</div>
            <div class="value" id="assetSellable">-</div>
          </div>
        </div>
      </div>

      <div class="asset-bars" id="assetsBars"></div>
    </div>

      <!-- ë§¤ìˆ˜ ì™„ë£Œ ì¹´ë“œ -->
      <div class="col-12 col-md-6">
        <div class="card border-success rounded-3 p-3" style="background: linear-gradient(135deg, rgba(14,203,129,0.1), rgba(14,203,129,0.05));">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h5 class="m-0" style="color: #0ecb81;">ğŸ›’ ë§¤ìˆ˜ ì™„ë£Œ</h5>
              <small class="text-muted" id="buyStatsTime">-</small>
            </div>
            <span id="buyCount" class="badge bg-success" style="font-size: 16px;">0</span>
          </div>
          
          <div class="row g-2 mb-3">
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">ì´ ë§¤ìˆ˜ ê¸ˆì•¡</div>
                <div id="buyTotalAmount" style="font-size: 16px; font-weight: 700; color: #0ecb81;">0 KRW</div>
              </div>
            </div>
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">í‰ê·  ë§¤ìˆ˜ê°€</div>
                <div id="buyAvgPrice" style="font-size: 16px; font-weight: 700; color: #0ecb81;">0 KRW</div>
              </div>
            </div>
          </div>
          
          <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px; max-height: 200px; overflow-y: auto;">
            <div class="text-muted mb-2" style="font-size: 11px;">ìµœê·¼ ë§¤ìˆ˜ ë‚´ì—­</div>
            <div id="buyOrderList" style="font-size: 12px; color: #e6eefc;">
              <div class="text-center text-muted py-2">ë§¤ìˆ˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ë§¤ë„ ì™„ë£Œ ì¹´ë“œ -->
      <div class="col-12 col-md-6">
        <div class="card border-danger rounded-3 p-3" style="background: linear-gradient(135deg, rgba(246,70,93,0.1), rgba(246,70,93,0.05));">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h5 class="m-0" style="color: #f6465d;">ğŸ’° ë§¤ë„ ì™„ë£Œ</h5>
              <small class="text-muted" id="sellStatsTime">-</small>
            </div>
            <span id="sellCount" class="badge bg-danger" style="font-size: 16px;">0</span>
          </div>
          
          <div class="row g-2 mb-3">
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">ì´ ë§¤ë„ ê¸ˆì•¡</div>
                <div id="sellTotalAmount" style="font-size: 16px; font-weight: 700; color: #f6465d;">0 KRW</div>
              </div>
            </div>
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">í‰ê·  ë§¤ë„ê°€</div>
                <div id="sellAvgPrice" style="font-size: 16px; font-weight: 700; color: #f6465d;">0 KRW</div>
              </div>
            </div>
          </div>
          
          <div class="row g-2 mb-3">
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">ì´ ìˆ˜ìµ</div>
                <div id="totalProfit" style="font-size: 16px; font-weight: 700;">0 KRW</div>
              </div>
            </div>
            <div class="col-6">
              <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px;">
                <div class="text-muted" style="font-size: 10px;">ìˆ˜ìµë¥ </div>
                <div id="profitRate" style="font-size: 16px; font-weight: 700;">0%</div>
              </div>
            </div>
          </div>
          
          <div style="background: rgba(14,20,36,0.6); border-radius: 6px; padding: 10px; max-height: 200px; overflow-y: auto;">
            <div class="text-muted mb-2" style="font-size: 11px;">ìµœê·¼ ë§¤ë„ ë‚´ì—­</div>
            <div id="sellOrderList" style="font-size: 12px; color: #e6eefc;">
              <div class="text-center text-muted py-2">ë§¤ë„ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ë§¤ìˆ˜/ë§¤ë„ ë¡œê·¸ ì„¹ì…˜ -->
    <div class="row g-3 mb-3">
      <div class="col-12">
        <div class="card border-secondary rounded-3 p-3" style="background: rgba(14,20,36,0.6);">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0">ê±°ë˜ ë¡œê·¸</h5>
            <button id="tradeLogRefresh" class="btn btn-sm btn-outline-info">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="tradeLogList" style="max-height: 220px; overflow-y: auto; font-size: 12px; color: #e6eefc;">
            <div class="text-center text-muted py-2">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        </div>
      </div>
    </div>

        <div class="card border-secondary rounded-3 p-3">
          <div class="row g-2 align-items-center mb-3 toolbar">
            <div class="col-auto">
              <select id="timeframe" class="form-select form-select-sm">
                <option value="minute1">1m</option>
                <option value="minute3">3m</option>
                <option value="minute5">5m</option>
                <option value="minute10" selected>10m</option>
                <option value="minute15">15m</option>
                <option value="minute30">30m</option>
                <option value="minute60">1h</option>
                <option value="day">1D</option>
              </select>
            </div>
            <div class="col-auto"><button id="botStart" class="btn btn-primary btn-sm">Start Bot</button></div>
            <div class="col-auto"><button id="botStop" class="btn btn-outline-light btn-sm">Stop Bot</button></div>
            <div class="col-auto"><button id="btnShot" class="btn btn-secondary btn-sm">Screenshot</button></div>
            <div class="col-auto"><button id="btnBacktest" class="btn btn-outline-info btn-sm">Backtest</button></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="autoBtToggle">
              <label class="form-check-label text-muted" for="autoBtToggle">Auto BT</label>
            </div>
            <div class="col-auto text-muted">sec</div>
            <div class="col-auto"><input id="autoBtSec" type="number" value="60" min="10" step="10" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnOptimize" class="btn btn-success btn-sm">Auto-Tune NB</button></div>
            <div class="col-auto"><button id="btnTrain" class="btn btn-warning btn-sm">Train (Auto Period)</button></div>
            <div class="col-auto text-muted">Cnt</div>
            <div class="col-auto"><input id="trainCount" type="number" value="1800" min="300" step="300" class="form-control form-control-sm" style="width:90px" /></div>
            <div class="col-auto text-muted">Seg</div>
            <div class="col-auto"><input id="trainSeg" type="number" value="3" min="2" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnMlTrain" class="btn btn-danger btn-sm">ML Train</button></div>
            <div class="col-auto"><button id="btnMlPredict" class="btn btn-outline-danger btn-sm">ML Predict</button></div>
            <div class="col-12 col-lg-4">
              <div class="card border-secondary rounded-3 p-2" style="min-height:80px">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <strong class="text-white">Model Insight</strong>
                  <span id="miZone" class="badge bg-secondary">-</span>
                </div>
                <div id="miText" style="font-size:12px; color:#e6eefc">-</div>
              </div>
            </div>
            <div class="col-auto"><button id="btnMlMetrics" class="btn btn-outline-warning btn-sm">ML Metrics</button></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="mlAuto">
              <label class="form-check-label text-muted" for="mlAuto">ML Auto</label>
            </div>
            <div class="col-auto text-muted">N</div>
            <div class="col-auto"><input id="mlRandN" type="number" value="12" min="1" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnMlRandom" class="btn btn-outline-warning btn-sm">ML Random</button></div>
            <div class="col-auto"><button id="btnClearOrders" class="btn btn-outline-danger btn-sm">Clear Orders</button></div>
            <div class="col-auto text-muted">NB Window</div>
            <div class="col-auto"><input id="nbWindow" type="number" value="100" min="20" step="10" class="form-control form-control-sm" style="width:90px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="nbToggle" checked>
              <label class="form-check-label text-muted" for="nbToggle">Show NB</label>
            </div>
            <div class="col-12"></div>
            <div class="col-auto text-muted">BUYâ‰¥r</div>
            <div class="col-auto"><input id="nbBuyTh" type="number" value="0.70" min="0.5" max="0.95" step="0.01" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">SELLâ‰¤r</div>
            <div class="col-auto"><input id="nbSellTh" type="number" value="0.30" min="0.05" max="0.5" step="0.01" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">Pullback%</div>
            <div class="col-auto"><input id="nbPullback" type="number" value="40" min="10" max="80" step="1" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">Debounce</div>
            <div class="col-auto"><input id="nbDebounce" type="number" value="6" min="0" max="20" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">Forecast</div>
            <div class="col-auto"><input id="fcWindow" type="number" value="50" min="10" step="5" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto"><input id="fcHorizon" type="number" value="30" min="1" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="fcToggle" checked>
              <label class="form-check-label text-muted" for="fcToggle">Show</label>
            </div>
            
            <div class="col-auto text-muted">Paper</div>
            <div class="col-auto">
              <select id="paperMode" class="form-select form-select-sm">
                <option value="true" selected>true</option>
                <option value="false">false</option>
              </select>
            </div>
            <div class="col-auto text-muted">Order KRW</div>
            <div class="col-auto"><input id="orderKrw" type="number" value="5000" min="1000" step="1000" class="form-control form-control-sm" style="width:110px" /></div>
            <div class="col-auto text-muted">EMA</div>
            <div class="col-auto"><input id="emaFast" type="number" value="10" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto">/</div>
            <div class="col-auto"><input id="emaSlow" type="number" value="30" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="emaFilter" checked>
              <label class="form-check-label text-muted" for="emaFilter">EMA Filter</label>
            </div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="nbFromEma">
              <label class="form-check-label text-muted" for="nbFromEma">NB from EMA</label>
            </div>
            <div class="col-auto text-muted">NB EMA</div>
            <div class="col-auto"><input id="nbEmaPeriod" type="number" value="10" min="2" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-12"></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showSMA" checked>
              <label class="form-check-label text-muted" for="showSMA">SMA</label>
            </div>
            <div class="col-auto text-muted">50</div>
            <div class="col-auto"><input id="sma50" type="number" value="50" min="5" step="5" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">100</div>
            <div class="col-auto"><input id="sma100" type="number" value="100" min="10" step="5" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">200</div>
            <div class="col-auto"><input id="sma200" type="number" value="200" min="20" step="10" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showEMA9" checked>
              <label class="form-check-label text-muted" for="showEMA9">EMA 9/12/26</label>
            </div>
            <div class="col-auto text-muted">Ichimoku</div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showIchimoku">
              <label class="form-check-label text-muted" for="showIchimoku">Tenkan/Kijun</label>
            </div>
            <div class="col-auto text-muted">9</div>
            <div class="col-auto"><input id="ichiTenkan" type="number" value="9" min="5" step="1" class="form-control form-control-sm" style="width:60px" /></div>
            <div class="col-auto text-muted">26</div>
            <div class="col-auto"><input id="ichiKijun" type="number" value="26" min="10" step="1" class="form-control form-control-sm" style="width:60px" /></div>
          </div>
          <hr class="text-secondary"/>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong class="text-white">Live Log</strong>
            <div>
              <button id="btnClearLog" class="btn btn-sm btn-outline-light me-2">Clear</button>
              <div class="form-check form-switch d-inline-block">
                <input class="form-check-input" type="checkbox" id="logAutoscroll">
                <label class="form-check-label text-muted" for="logAutoscroll">Auto</label>
              </div>
            </div>
          </div>
          <pre id="logBox" style="height:160px;overflow:auto;overflow-anchor:none;background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:8px;margin:0;color:#a7b4d7;font-size:12px;line-height:1.35"></pre>
          <div id="mlMetricsBox" class="mt-2" style="font-size:12px;color:#e6eefc"></div>
        </div>
      </div>
    </div>
  </div>

     <!-- Orders Log Bottom Section -->
   <div class="row g-3 justify-content-center mt-3">
     <div class="col-12">
       <div class="card border-secondary rounded-3 p-3">
         <div class="d-flex justify-content-between align-items-center mb-2">
           <strong class="text-white">Order Log</strong>
           <div>
             <button id="btnOrderExport" class="btn btn-sm btn-outline-light me-2">Export CSV</button>
             <button id="btnOrderClear" class="btn btn-sm btn-outline-danger">Clear</button>
           </div>
         </div>
         <div id="orderLog" style="height:180px;overflow:auto;overflow-anchor:none;background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:8px;margin:0;color:#e6eefc;font-size:12px;line-height:1.35"></div>
       </div>
     </div>
   </div>
   </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
  <script src="/static/mayor-guidance.js?v=dev"></script>
  <script src="/static/village-trading-process.js?v=dev"></script>
  <script src="/static/trainer-system.js?v=dev"></script>
  <script src="/static/village-learning-system.js?v=dev"></script>
  <script src="/static/guild-members-status.js?v=dev"></script>
  <script src="/static/ui.js?v=dev"></script>
  <!-- External N/B calculation library (overrides local BIT_* functions) -->
  <script src="https://xn--9l4b4xi9r.com/_8%EB%B9%84%ED%8A%B8/js/bitCalculation.v.0.2.js"></script>
  
  <!-- ë¶„ë´‰ ì¹´ë“œ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    let ccSummaryChart = null; // ê¸€ë¡œë²Œ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤
    let currentActiveTimeframe = 'minute10'; // í˜„ì¬ í™œì„± ë¶„ë´‰ ì¶”ì 
    window.currentActiveTimeframe = currentActiveTimeframe; // ì „ì—­ ë™ê¸°í™”
    
    // í˜„ì¬ ì¹´ë“œ ë¡œë”
    function loadCurrentCard() {
      // currentActiveTimeframe ì‚¬ìš© (timeframe select ìš”ì†Œë³´ë‹¤ ë” ì‹ ë¢°ì„± ìˆìŒ)
      const interval = (window.currentActiveTimeframe || currentActiveTimeframe || 'minute10');
      document.getElementById('ccInterval').textContent = interval;
      
      // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
      const now = new Date();
      const timeStr = now.toLocaleTimeString('ko-KR');
      document.getElementById('ccTimestamp').textContent = timeStr;
      
      const url = `/api/nbverse/card?interval=${encodeURIComponent(interval)}&count=300&save=true`;
      fetch(url).then(r => r.json()).then(j => {
        if (!j || !j.ok) { throw new Error(j && j.error ? j.error : 'failed'); }
        
        // í˜„ì¬ ê°€ê²©
        document.getElementById('ccPrice').textContent = j.current_price != null ? j.current_price.toLocaleString() : '-';
        
        // í˜„ì¬ ê±°ë˜ëŸ‰ê³¼ ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° (chart ë°ì´í„°ì˜ ë§ˆì§€ë§‰ ê°’)
        if (j.chart && j.chart.length > 0) {
          const lastCandle = j.chart[j.chart.length - 1];
          const currentVolume = lastCandle.volume || 0;
          const currentTurnover = (j.current_price || 0) * currentVolume;
          
          // ê±°ë˜ëŸ‰ í‘œì‹œ (8ìë¦¬ê¹Œì§€)
          document.getElementById('ccVolume').textContent = 
            currentVolume > 0 ? Number(currentVolume).toFixed(8) : '-';
          
          // ê±°ë˜ëŒ€ê¸ˆ í‘œì‹œ (ì •ìˆ˜ ë˜ëŠ” ì†Œìˆ˜ì  2ìë¦¬)
          document.getElementById('ccTurnover').textContent = 
            currentTurnover > 0 ? Number(currentTurnover).toLocaleString('ko-KR', {maximumFractionDigits: 0}) : '-';
        }
        
        // N/B ê°’ë“¤
        const nb = j.nb || {};
        const price = nb.price || {};
        const volume = nb.volume || {};
        const turnover = nb.turnover || {};
        const fmt = (v) => (v == null ? '-' : Number(v).toFixed(10));
        
        document.getElementById('ccPriceMax').textContent = fmt(price.max);
        document.getElementById('ccPriceMin').textContent = fmt(price.min);
        document.getElementById('ccVolMax').textContent = fmt(volume.max);
        document.getElementById('ccVolMin').textContent = fmt(volume.min);
        document.getElementById('ccTurnMax').textContent = fmt(turnover.max);
        document.getElementById('ccTurnMin').textContent = fmt(turnover.min);
        
        // ì €ì¥ ìƒíƒœ
        const saveMeta = j.save && j.save.paths ? j.save.paths : null;
        document.getElementById('ccSaveHint').textContent = saveMeta ? 'âœ… ì™„ë£Œ' : 'â³ ëŒ€ê¸°';
        
        // ìš”ì•½ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        if (price.values && price.values.length > 0) {
          drawSummaryChart(price.values, volume.values, turnover.values);
        }
        
        // N/B Zone Status í‘œì‹œ
        fetchNBZoneStatus(interval);
        
        console.log('âœ… loadCurrentCard completed', j);
      }).catch(err => {
        document.getElementById('ccSaveHint').textContent = 'âŒ ì˜¤ë¥˜';
        console.error('loadCurrentCard error', err);
      });
    }
    
    // N/B Zone Status ì¡°íšŒ ë° í‘œì‹œ
    function fetchNBZoneStatus(interval) {
      const url = `/api/nbverse/zone?interval=${encodeURIComponent(interval)}`;

      fetch(url)
        .then(r => r.json())
        .then(j => {
          if (j && j.ok) {
            const zoneEl = document.getElementById('ccNBZone');
            if (!zoneEl) return;

            const currentZone = j.current_zone || '-';
            const zoneLabel = currentZone === 'BLUE' ? 'ğŸ”µ BLUE' : currentZone === 'ORANGE' ? 'ğŸŸ  ORANGE' : 'âšª NONE';
            const zoneCount = j.zone_count || '-';
            const zoneColor = currentZone === 'BLUE' ? '#00d1ff' : currentZone === 'ORANGE' ? '#ffb703' : '#888888';

            zoneEl.innerHTML = `
              <div style="text-align: center;">
                <div style="font-size: 13px; font-weight: 700; color: ${zoneColor}; margin-bottom: 4px;">
                  ${zoneLabel}
                </div>
                <div style="font-size: 10px; color: #d9e2f3;">ì§€ë‚œ ${zoneCount || '?'}ê°œ êµ¬ê°„</div>
              </div>
            `;

            console.log('âœ… N/B Zone Status updated:', currentZone, zoneCount);
          } else {
            console.warn('âš ï¸ fetchNBZoneStatus failed:', j);
            const zoneEl = document.getElementById('ccNBZone');
            if (zoneEl) zoneEl.textContent = 'ë°ì´í„° ì—†ìŒ';
          }
        })
        .catch(err => {
          console.error('fetchNBZoneStatus error', err);
          const zoneEl = document.getElementById('ccNBZone');
          if (zoneEl) zoneEl.textContent = 'ì¡°íšŒ ì¤‘...';
        });
    }
    
    // ìš”ì•½ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
    function drawSummaryChart(priceValues, volumeValues, turnoverValues) {
      const ctx = document.getElementById('ccSummaryChart');
      if (!ctx) return;
      
      // ìµœëŒ€ 15ê°œ í¬ì¸íŠ¸ë¡œ ê°„ë‹¨íˆ í‘œì‹œ
      const step = Math.max(1, Math.ceil(priceValues.length / 15));
      const labels = Array.from({length: Math.ceil(priceValues.length / step)}, (_, i) => '');
      const priceSample = priceValues.filter((_, i) => i % step === 0);
      const volumeSample = (volumeValues || []).filter((_, i) => i % step === 0);
      
      // ì •ê·œí™” (0~1 ë²”ìœ„)
      const normalize = (arr) => {
        if (!arr || arr.length === 0) return [];
        const vals = arr.filter(v => v != null);
        if (vals.length === 0) return arr.map(() => 0);
        const min = Math.min(...vals);
        const max = Math.max(...vals);
        const range = max - min || 1;
        return arr.map(v => v == null ? 0 : (v - min) / range);
      };
      
      const normalizedPrice = normalize(priceSample);
      const normalizedVol = normalize(volumeSample);
      
      // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
      if (ccSummaryChart) {
        ccSummaryChart.destroy();
      }
      
      // ìƒˆ ì°¨íŠ¸ ìƒì„±
      ccSummaryChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'ê°€ê²©',
              data: normalizedPrice,
              borderColor: '#00d1ff',
              backgroundColor: 'rgba(0,209,255,0.15)',
              borderWidth: 2,
              fill: true,
              tension: 0.3,
              pointRadius: 1,
              pointHoverRadius: 2,
              pointBackgroundColor: '#00d1ff',
              yAxisID: 'y'
            },
            {
              label: 'ê±°ë˜ëŸ‰',
              data: normalizedVol,
              borderColor: '#0ecb81',
              backgroundColor: 'transparent',
              borderWidth: 1,
              fill: false,
              tension: 0.3,
              pointRadius: 0.5,
              pointBackgroundColor: '#0ecb81',
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: {
            duration: 300
          },
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0,0,0,0.8)',
              titleColor: '#ffffff',
              bodyColor: '#e6eefc',
              borderColor: 'rgba(255,255,255,0.2)',
              borderWidth: 1,
              padding: 6,
              displayColors: true,
              titleFont: { size: 10 },
              bodyFont: { size: 9 }
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: false,
              position: 'left',
              min: 0,
              max: 1
            },
            y1: {
              type: 'linear',
              display: false,
              position: 'right',
              min: 0,
              max: 1
            },
            x: {
              display: false,
              grid: {
                display: false
              }
            }
          }
        }
      });
    }
    
    // Debounce timer for preventing rapid updates (1ê°œì”©ë§Œ)
    let currentCardTimeout = null;
    
    function loadCurrentCardDebounced() {
      if (currentCardTimeout) clearTimeout(currentCardTimeout);
      currentCardTimeout = setTimeout(() => {
        loadCurrentCard();
        currentCardTimeout = null;
      }, 300); // 300ms debounce
    }
    
    // ì „ì—­ window ê°ì²´ì—ë„ í• ë‹¹
    window.loadCurrentCard = loadCurrentCard;
    window.loadCurrentCardDebounced = loadCurrentCardDebounced;
    
    // timeframe ë³€ê²½ ì‹œ í˜„ì¬ ì¹´ë“œ ì—…ë°ì´íŠ¸ (debounce ì ìš©)
    function onTimeframeChange() {
      console.log('ğŸ• Timeframe changed, updating current card...');
            // ìƒë‹¨ selectì˜ ê°’ìœ¼ë¡œ currentActiveTimeframe ì—…ë°ì´íŠ¸
            const sel = document.getElementById('timeframe');
            if (sel) {
              currentActiveTimeframe = sel.value;
              window.currentActiveTimeframe = sel.value;
            }
      loadCurrentCardDebounced();
    }
    window.onTimeframeChange = onTimeframeChange;

    // ê±°ë˜ ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
    function addTradeLog(message, type = 'info') {
      const logList = document.getElementById('tradeLogList');
      if (!logList) return;
      
      // ì´ˆê¸° "ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ ì œê±°
      const emptyMsg = logList.querySelector('.text-center.text-muted');
      if (emptyMsg) emptyMsg.remove();
      
      const logEntry = document.createElement('div');
      logEntry.style.cssText = 'padding: 8px; margin-bottom: 6px; border-radius: 4px; border-left: 3px solid;';
      
      const now = new Date().toLocaleTimeString('ko-KR');
      
      if (type === 'success') {
        logEntry.style.backgroundColor = 'rgba(14, 203, 129, 0.1)';
        logEntry.style.borderLeftColor = '#0ecb81';
        logEntry.innerHTML = `<div style="color: #0ecb81; font-weight: 600;">[${now}] âœ… ${message}</div>`;
      } else if (type === 'error') {
        logEntry.style.backgroundColor = 'rgba(246, 70, 93, 0.1)';
        logEntry.style.borderLeftColor = '#f6465d';
        logEntry.innerHTML = `<div style="color: #f6465d; font-weight: 600;">[${now}] âŒ ${message}</div>`;
      } else {
        logEntry.style.backgroundColor = 'rgba(230, 238, 252, 0.05)';
        logEntry.style.borderLeftColor = '#6c757d';
        logEntry.innerHTML = `<div style="color: #e6eefc;">[${now}] ${message}</div>`;
      }
      
      logList.insertBefore(logEntry, logList.firstChild);
      
      // ìµœëŒ€ 50ê°œ ë¡œê·¸ë§Œ ìœ ì§€
      while (logList.children.length > 50) {
        logList.removeChild(logList.lastChild);
      }
    }
    window.addTradeLog = addTradeLog;

    // ì´ˆê¸°í™” í•¨ìˆ˜ (ë™ì  ë¡œë“œì—ì„œë„ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡)
    function initCustomDashboard() {
      console.log('ğŸ¯ Initializing Custom Dashboard...');
      
      const refreshBtn = document.getElementById('ccRefresh');
      if (refreshBtn) refreshBtn.addEventListener('click', loadCurrentCard);
      
      const tradeLogRefreshBtn = document.getElementById('tradeLogRefresh');
      if (tradeLogRefreshBtn) {
        tradeLogRefreshBtn.addEventListener('click', ()=>{
          const logList = document.getElementById('tradeLogList');
          if (logList) {
            logList.innerHTML = '<div class="text-center text-muted py-2">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            addTradeLog('ê±°ë˜ ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
          }
        });
      }
      
      const ccBuyBtn = document.getElementById('ccBuy');
      if (ccBuyBtn) {
        ccBuyBtn.addEventListener('click', async ()=>{
        try {
          const ccAmount = document.getElementById('ccBuyAmount');
          const buyAmount = ccAmount ? Number(ccAmount.value) : 5000;
          
          console.log('ğŸ›’ í˜„ì¬ ì¹´ë“œ ë§¤ìˆ˜ ì‹œì‘:', buyAmount, 'KRW');
          addTradeLog(`í˜„ì¬ ì¹´ë“œ ë§¤ìˆ˜ ì‹œì‘ (${buyAmount.toLocaleString()} KRW)`, 'info');
          
          // Use the same postJson function from ui.js
          if (typeof postJson !== 'function') {
            const errMsg = 'postJson í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ui.jsê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
            addTradeLog(errMsg, 'error');
            console.error(errMsg);
            return;
          }
          
          // Call buy API with krw parameter (not amount)
          const result = await postJson('/api/trade/buy', { krw: buyAmount });
          
          if (result && result.ok && result.order) {
            console.log('âœ… ë§¤ìˆ˜ ì„±ê³µ:', result.order);
            const price = Number(result.order.price||0).toLocaleString();
            const size = Number(result.order.size||0).toFixed(6);
            const paperMode = result.order.paper ? ' [PAPER]' : '';
            addTradeLog(`ë§¤ìˆ˜ ì™„ë£Œ! ê°€ê²©: ${price} KRW / ìˆ˜ëŸ‰: ${size}${paperMode}`, 'success');
            
            // Refresh trade stats and balance
            if (typeof loadTradeStats === 'function') setTimeout(loadTradeStats, 500);
            if (typeof refreshAssets === 'function') setTimeout(refreshAssets, 1000);
          } else {
            const error = result?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
            console.error('âŒ ë§¤ìˆ˜ ì‹¤íŒ¨:', error);
            addTradeLog(`ë§¤ìˆ˜ ì‹¤íŒ¨: ${error}`, 'error');
          }
        } catch (err) {
          console.error('ë§¤ìˆ˜ ì—ëŸ¬:', err);
          addTradeLog(`ë§¤ìˆ˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${err.message}`, 'error');
        }
      });
      const sel = document.getElementById('timeframe');
      if (sel) {
        sel.addEventListener('change', onTimeframeChange);
      }
      // ì´ˆê¸° ë¡œë“œ
      // ì´ˆê¸° ë¶„ë´‰ ì„¤ì •
      if (sel && sel.value) {
        currentActiveTimeframe = sel.value;
        window.currentActiveTimeframe = sel.value;
      }
      loadCurrentCard();
      
      console.log('âœ… Custom Dashboard initialized');
    }
    window.initCustomDashboard = initCustomDashboard;
    
    // DOMContentLoaded ë˜ëŠ” ì¦‰ì‹œ ì‹¤í–‰
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initCustomDashboard);
    } else {
      // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
      setTimeout(initCustomDashboard, 100);
    }
    
    // ê±°ë˜ í†µê³„ ë¡œë”
    async function loadTradeStats() {
      try {
        const now = new Date().toLocaleTimeString('ko-KR');
        document.getElementById('buyStatsTime').textContent = now;
        document.getElementById('sellStatsTime').textContent = now;
        
        const response = await fetch('/api/orders');
        const data = await response.json();
        
        if (!data || !data.ok) {
          console.error('Failed to load trade stats:', data);
          return;
        }
        
        const orders = data.data || [];
        const buyOrders = orders.filter(o => o.side === 'bid' || o.side === 'BUY');
        const sellOrders = orders.filter(o => o.side === 'ask' || o.side === 'SELL');

        // ë§¤ìˆ˜/ë§¤ë„ ë¡œê·¸ (ìµœì‹ ìˆœ)
        const logEl = document.getElementById('tradeLogList');
        if (logEl) {
          const ordered = [...orders].sort((a, b) => (Number(b.time || b.ts || 0) - Number(a.time || a.ts || 0)));
          if (ordered.length > 0) {
            logEl.innerHTML = ordered.slice(0, 30).map(o => {
              const isBuy = (o.side === 'bid' || o.side === 'BUY');
              const price = Number(o.price || 0).toLocaleString();
              const size = Number(o.size || 0).toFixed(6);
              const time = o.time ? new Date(o.time).toLocaleTimeString('ko-KR') : (o.ts ? new Date(o.ts).toLocaleTimeString('ko-KR') : '-');
              const paper = o.paper ? '[PAPER]' : '';
              const sideBadge = isBuy ? '<span style="color:#0ecb81; font-weight:700;">BUY</span>' : '<span style="color:#f6465d; font-weight:700;">SELL</span>';
              return `<div style="padding:6px 0; border-bottom:1px solid rgba(255,255,255,0.05);">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <div>${sideBadge} <span style="color:#9aa8c2;">${time}</span></div>
                  <div style="color:${isBuy ? '#0ecb81' : '#f6465d'}; font-weight:600;">${price} KRW</div>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:11px; color:#9aa8c2;">
                  <span>${size} ${o.market || 'BTC'} ${paper}</span>
                  <span>${(Number(o.price || 0) * Number(o.size || 0)).toFixed(0).toLocaleString()} KRW</span>
                </div>
              </div>`;
            }).join('');
          } else {
            logEl.innerHTML = '<div class="text-center text-muted py-2">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
          }
        }
        
        // ë§¤ìˆ˜ í†µê³„
        document.getElementById('buyCount').textContent = buyOrders.length;
        const buyTotal = buyOrders.reduce((sum, o) => sum + (Number(o.price || 0) * Number(o.size || 0)), 0);
        document.getElementById('buyTotalAmount').textContent = Math.round(buyTotal).toLocaleString() + ' KRW';
        const buyAvg = buyOrders.length > 0 ? buyTotal / buyOrders.length : 0;
        document.getElementById('buyAvgPrice').textContent = Math.round(buyAvg).toLocaleString() + ' KRW';
        
        // ë§¤ìˆ˜ ë‚´ì—­ ëª©ë¡
        const buyListEl = document.getElementById('buyOrderList');
        if (buyOrders.length > 0) {
          buyListEl.innerHTML = buyOrders.slice(0, 10).map(o => {
            const price = Number(o.price || 0).toLocaleString();
            const size = Number(o.size || 0).toFixed(6);
            const time = o.time ? new Date(o.time).toLocaleTimeString('ko-KR') : '-';
            const paper = o.paper ? '[PAPER]' : '';
            return `<div style="padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
              <div style="display: flex; justify-content: space-between;">
                <span style="color: #0ecb81;">${price} KRW</span>
                <span class="text-muted">${time}</span>
              </div>
              <div style="font-size: 10px; color: #888;">${size} ${o.market || 'BTC'} ${paper}</div>
            </div>`;
          }).join('');
        } else {
          buyListEl.innerHTML = '<div class="text-center text-muted py-2">ë§¤ìˆ˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        }
        
        // ë§¤ë„ í†µê³„
        document.getElementById('sellCount').textContent = sellOrders.length;
        const sellTotal = sellOrders.reduce((sum, o) => sum + (Number(o.price || 0) * Number(o.size || 0)), 0);
        document.getElementById('sellTotalAmount').textContent = Math.round(sellTotal).toLocaleString() + ' KRW';
        const sellAvg = sellOrders.length > 0 ? sellTotal / sellOrders.length : 0;
        document.getElementById('sellAvgPrice').textContent = Math.round(sellAvg).toLocaleString() + ' KRW';
        
        // ìˆ˜ìµ ê³„ì‚°
        const profit = sellTotal - buyTotal;
        const profitRate = buyTotal > 0 ? ((profit / buyTotal) * 100) : 0;
        const profitEl = document.getElementById('totalProfit');
        const profitRateEl = document.getElementById('profitRate');
        
        profitEl.textContent = Math.round(profit).toLocaleString() + ' KRW';
        profitEl.style.color = profit >= 0 ? '#0ecb81' : '#f6465d';
        profitRateEl.textContent = profitRate.toFixed(2) + '%';
        profitRateEl.style.color = profit >= 0 ? '#0ecb81' : '#f6465d';
        
        // ë§¤ë„ ë‚´ì—­ ëª©ë¡
        const sellListEl = document.getElementById('sellOrderList');
        if (sellOrders.length > 0) {
          sellListEl.innerHTML = sellOrders.slice(0, 10).map(o => {
            const price = Number(o.price || 0).toLocaleString();
            const size = Number(o.size || 0).toFixed(6);
            const time = o.time ? new Date(o.time).toLocaleTimeString('ko-KR') : '-';
            const paper = o.paper ? '[PAPER]' : '';
            return `<div style="padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
              <div style="display: flex; justify-content: space-between;">
                <span style="color: #f6465d;">${price} KRW</span>
                <span class="text-muted">${time}</span>
              </div>
              <div style="font-size: 10px; color: #888;">${size} ${o.market || 'BTC'} ${paper}</div>
            </div>`;
          }).join('');
        } else {
          sellListEl.innerHTML = '<div class="text-center text-muted py-2">ë§¤ë„ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        }
        
        console.log('âœ… Trade stats loaded:', { buyCount: buyOrders.length, sellCount: sellOrders.length });
      } catch (err) {
        console.error('loadTradeStats error:', err);
      }
    }
    
    // ê±°ë˜ í†µê³„ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ë° ì´ˆê¸° ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
      const refreshBtn = document.getElementById('tradeStatsRefresh');
      if (refreshBtn) refreshBtn.addEventListener('click', loadTradeStats);

      const logRefreshBtn = document.getElementById('tradeLogRefresh');
      if (logRefreshBtn) logRefreshBtn.addEventListener('click', loadTradeStats);
      
      // ì´ˆê¸° ë¡œë“œ
      loadTradeStats();
      
      // 30ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
      setInterval(loadTradeStats, 30000);
    });
    
    // í•˜ë‹¨ ë¶„ë´‰ ì¹´ë“œ ê¸°ëŠ¥ (ìë™ ìˆœíšŒ ìë™ ì‹œì‘)
    document.addEventListener('DOMContentLoaded', function() {
      const timeframeCardsBottom = document.querySelectorAll('.timeframe-card-bottom');
      const timeframeSelect = document.getElementById('timeframe');
      const currentTimeframeBadgeBottom = document.getElementById('currentTimeframeBottom');
      const btnAutoRotateBottom = document.getElementById('btnAutoRotateBottom');
      
      let autoRotateIntervalBottom = null;
      let currentTimeframeIndexBottom = 0; // 1më¶€í„° ì‹œì‘
      
      // í•˜ë‹¨ ë¶„ë´‰ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
      timeframeCardsBottom.forEach((card, index) => {
        card.addEventListener('click', function() {
          const timeframe = this.getAttribute('data-timeframe');

          // í™œì„± ì¹´ë“œ ë³€ê²½
          timeframeCardsBottom.forEach(c => c.classList.remove('active'));
          this.classList.add('active');

          // ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
          timeframeCardsBottom.forEach(c => {
            c.querySelector('.timeframe-status-bottom').textContent = 'ëŒ€ê¸°';
          });
          this.querySelector('.timeframe-status-bottom').textContent = 'í™œì„±';

          // UI ë°°ì§€ ì—…ë°ì´íŠ¸
          if (currentTimeframeBadgeBottom) {
            currentTimeframeBadgeBottom.textContent = this.querySelector('.timeframe-name-bottom').textContent;
          }

          // í˜„ì¬ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
          currentTimeframeIndexBottom = index;

          // ë¶„ë´‰ ì „í™˜ (ê°€ëŠ¥í•˜ë©´ ì „ì—­ í•¨ìˆ˜ ì‚¬ìš©í•´ ìƒë‹¨ í‘œì‹œê¹Œì§€ ë™ê¸°í™”)
          if (typeof window.switchToTimeframe === 'function') {
            window.switchToTimeframe(timeframe);
          } else {
            timeframeSelect.value = timeframe;
            timeframeSelect.dispatchEvent(new Event('change'));
          }

          console.log(`í•˜ë‹¨ ë¶„ë´‰ ë³€ê²½: ${timeframe}`);
        
          // í˜„ì¬ í™œì„± ë¶„ë´‰ ì—…ë°ì´íŠ¸
          currentActiveTimeframe = timeframe;
          window.currentActiveTimeframe = timeframe;
        
          // í˜„ì¬ ì¹´ë“œ ì—…ë°ì´íŠ¸
          loadCurrentCardDebounced();
        });
      });
      
      // í•˜ë‹¨ ìë™ ìˆœíšŒ í† ê¸€
      if (btnAutoRotateBottom) {
        btnAutoRotateBottom.addEventListener('click', function() {
          if (autoRotateIntervalBottom) {
            // ìë™ ìˆœíšŒ ì¤‘ì§€
            clearInterval(autoRotateIntervalBottom);
            autoRotateIntervalBottom = null;
            this.textContent = 'ìë™ ìˆœíšŒ';
            this.classList.remove('btn-danger');
            this.classList.add('btn-outline-info');
          } else {
            // ìë™ ìˆœíšŒ ì‹œì‘
            autoRotateIntervalBottom = setInterval(() => {
              currentTimeframeIndexBottom = (currentTimeframeIndexBottom + 1) % timeframeCardsBottom.length;
              timeframeCardsBottom[currentTimeframeIndexBottom].click();
            }, 5000); // 5ì´ˆë§ˆë‹¤ ìˆœíšŒ
            
            this.textContent = 'ìˆœíšŒ ì¤‘ì§€';
            this.classList.remove('btn-outline-info');
            this.classList.add('btn-danger');
          }
        });
      }
      
      // ì´ˆê¸° ì„¤ì • ë° ìë™ ìˆœíšŒ ìë™ ì‹œì‘
      if (timeframeCardsBottom.length > 0) {
        // 1më¶€í„° ì‹œì‘
        timeframeCardsBottom[0].click();
        
        // 2ì´ˆ í›„ ìë™ ìˆœíšŒ ì‹œì‘
        setTimeout(() => {
          if (btnAutoRotateBottom && !autoRotateIntervalBottom) {
            autoRotateIntervalBottom = setInterval(() => {
              currentTimeframeIndexBottom = (currentTimeframeIndexBottom + 1) % timeframeCardsBottom.length;
              timeframeCardsBottom[currentTimeframeIndexBottom].click();
            }, 5000); // 5ì´ˆë§ˆë‹¤ ìˆœíšŒ
            
            if (btnAutoRotateBottom) {
              btnAutoRotateBottom.textContent = 'ìˆœíšŒ ì¤‘ì§€';
              btnAutoRotateBottom.classList.remove('btn-outline-info');
              btnAutoRotateBottom.classList.add('btn-danger');
            }
          }
        }, 2000);
      }
     });
   </script>
</body>
</html>


